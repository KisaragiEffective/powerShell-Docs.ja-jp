---
ms.date: 07/10/2019
keywords: JEA, PowerShell, セキュリティ
title: JEA セキュリティの考慮事項
ms.openlocfilehash: befc24fec368c4f6d60477daf63bf17e9431133e
ms.sourcegitcommit: 46bebe692689ebedfe65ff2c828fe666b443198d
ms.translationtype: HT
ms.contentlocale: ja-JP
ms.lasthandoff: 07/10/2019
ms.locfileid: "67726591"
---
# <a name="jea-security-considerations"></a><span data-ttu-id="363e1-103">JEA セキュリティの考慮事項</span><span class="sxs-lookup"><span data-stu-id="363e1-103">JEA Security Considerations</span></span>

<span data-ttu-id="363e1-104">JEA はコンピューターの常駐管理者の数を減らし、セキュリティに対する姿勢を改善します。</span><span class="sxs-lookup"><span data-stu-id="363e1-104">JEA helps you improve your security posture by reducing the number of permanent administrators on your machines.</span></span> <span data-ttu-id="363e1-105">JEA では、ユーザーがシステムを管理するための新しいエントリ ポイントを作成するために、PowerShell のセッション構成が使用されます。</span><span class="sxs-lookup"><span data-stu-id="363e1-105">JEA uses a PowerShell session configuration to create a new entry point for users to manage the system.</span></span> <span data-ttu-id="363e1-106">管理タスクを実行するために、マシンに対して管理者特権の無制限ではないアクセスを必要とするユーザーには、JEA エンドポイントへのアクセスを許可することができます。</span><span class="sxs-lookup"><span data-stu-id="363e1-106">Users who need elevated, but not unlimited, access to the machine to do administrative tasks can be granted access to the JEA endpoint.</span></span> <span data-ttu-id="363e1-107">JEA を使用すると、このようなユーザーが完全な管理者アクセス権を持たずに管理者コマンドを実行できるので、このようなユーザーを高い特権のセキュリティ グループから削除することができます。</span><span class="sxs-lookup"><span data-stu-id="363e1-107">Since JEA allows these users to run admin commands without having full admin access, you can then remove those users from highly privileged security groups.</span></span>

## <a name="run-as-account"></a><span data-ttu-id="363e1-108">実行アカウント</span><span class="sxs-lookup"><span data-stu-id="363e1-108">Run-As account</span></span>

<span data-ttu-id="363e1-109">各 JEA エンドポイントには、指定された**実行**アカウントがあります。</span><span class="sxs-lookup"><span data-stu-id="363e1-109">Each JEA endpoint has a designated **run-as** account.</span></span> <span data-ttu-id="363e1-110">これは、接続ユーザーのアクションの実行に使用されるアカウントです。</span><span class="sxs-lookup"><span data-stu-id="363e1-110">This is the account under which the connecting user's actions are executed.</span></span> <span data-ttu-id="363e1-111">このアカウントは[セッション構成ファイル](session-configurations.md)で構成できます。選択したアカウントは、エンドポイントのセキュリティに大きく関係します。</span><span class="sxs-lookup"><span data-stu-id="363e1-111">This account is configurable in the [session configuration file](session-configurations.md), and the account you choose has a significant bearing on the security of your endpoint.</span></span>

<span data-ttu-id="363e1-112">**仮想アカウント**は、**実行**アカウントを構成するときに推奨される方法です。</span><span class="sxs-lookup"><span data-stu-id="363e1-112">**Virtual accounts** are the recommended way of configuring the **run-as** account.</span></span> <span data-ttu-id="363e1-113">仮想アカウントは 1 回限りの一時的なローカル アカウントです。JEA セッションの間、接続ユーザーが使用するために作成されます。</span><span class="sxs-lookup"><span data-stu-id="363e1-113">Virtual accounts are one-time, temporary local accounts that are created for the connecting user to use during the duration of their JEA session.</span></span> <span data-ttu-id="363e1-114">セッションが終了すると同時に仮想アカウントは破棄され、その後は使用できません。</span><span class="sxs-lookup"><span data-stu-id="363e1-114">As soon as their session is terminated, the virtual account is destroyed and can't be used anymore.</span></span> <span data-ttu-id="363e1-115">接続ユーザーは、仮想アカウントの資格情報を知りません。</span><span class="sxs-lookup"><span data-stu-id="363e1-115">The connecting user doesn't know the credentials for the virtual account.</span></span> <span data-ttu-id="363e1-116">リモート デスクトップや制約のない PowerShell エンドポイントなど、他の手段から仮想アカウントを使用してシステムにアクセスすることはできません。</span><span class="sxs-lookup"><span data-stu-id="363e1-116">The virtual account can't be used to access the system via other means like Remote Desktop or an unconstrained PowerShell endpoint.</span></span>

<span data-ttu-id="363e1-117">既定では、仮想アカウントは、コンピューターのローカル**管理者**グループに属します。</span><span class="sxs-lookup"><span data-stu-id="363e1-117">By default, virtual accounts belong to the local **Administrators** group on the machine.</span></span> <span data-ttu-id="363e1-118">それにより、システム上のあらゆるものを管理する完全な権限が与えられますが、ネットワーク上のリソースを管理する権限は与えられません。</span><span class="sxs-lookup"><span data-stu-id="363e1-118">This gives them full rights to manage anything on the system, but no rights to manage resources on the network.</span></span>
<span data-ttu-id="363e1-119">他のコンピューターで認証を行うと、ユーザー コンテキストは、仮想アカウントではなく、ローカル コンピューター アカウントになります。</span><span class="sxs-lookup"><span data-stu-id="363e1-119">When authenticating with other machines, the user context is that of the local computer account, not the virtual account.</span></span>

<span data-ttu-id="363e1-120">ローカルの**管理者**グループはないため、ドメイン コントローラーは特殊なケースです。</span><span class="sxs-lookup"><span data-stu-id="363e1-120">Domain controllers are a special case since there isn't a local **Administrators** group.</span></span> <span data-ttu-id="363e1-121">代わりに、仮想アカウントは **Domain Admins** に属しており、ドメイン コントローラー上のディレクトリ サービスを管理できます。</span><span class="sxs-lookup"><span data-stu-id="363e1-121">Instead, virtual accounts belong to **Domain Admins** and can manage the directory services on the domain controller.</span></span> <span data-ttu-id="363e1-122">JEA セッションがインスタンス化されたドメイン コントローラー上では、ドメイン ID はまだ使用に制限があります。</span><span class="sxs-lookup"><span data-stu-id="363e1-122">The domain identity is still restricted for use on the domain controller where the JEA session was instantiated.</span></span> <span data-ttu-id="363e1-123">ネットワーク アクセスは、代わりにドメイン コントローラー コンピューター オブジェクトから行われているように見えます。</span><span class="sxs-lookup"><span data-stu-id="363e1-123">Any network access appears to come from the domain controller computer object instead.</span></span>

<span data-ttu-id="363e1-124">いずれの場合も、仮想アカウントがどのセキュリティ グループに属するかを明示的に定義できます。</span><span class="sxs-lookup"><span data-stu-id="363e1-124">In both cases, you may explicitly define which security groups the virtual account belongs to.</span></span> <span data-ttu-id="363e1-125">ローカルまたはドメインの管理者特権なしでタスクを実行できる場合は、この方法をお勧めします。</span><span class="sxs-lookup"><span data-stu-id="363e1-125">This is a good practice when the task can be done without local or domain admin privileges.</span></span> <span data-ttu-id="363e1-126">管理者用にセキュリティ グループが既に定義されている場合は、そのグループに仮想アカウントのメンバーシップを付与します。</span><span class="sxs-lookup"><span data-stu-id="363e1-126">If you already have a security group defined for your admins, grant the virtual account membership to that group.</span></span> <span data-ttu-id="363e1-127">仮想アカウント グループのメンバーシップは、ワークステーションおよびメンバー サーバー上のローカル セキュリティ グループに制限されています。</span><span class="sxs-lookup"><span data-stu-id="363e1-127">Virtual account group membership is limited to local security groups on workstation and member servers.</span></span> <span data-ttu-id="363e1-128">ドメイン コントローラー上では、仮想アカウントはドメイン セキュリティ グループのメンバーである必要があります。</span><span class="sxs-lookup"><span data-stu-id="363e1-128">On domain controllers, virtual accounts must be members of domain security groups.</span></span>
<span data-ttu-id="363e1-129">仮想アカウントは、1 つ以上のセキュリティ グループに追加されると、既定のグループ (ローカルまたはドメイン管理者) には属さなくなります。</span><span class="sxs-lookup"><span data-stu-id="363e1-129">Once the virtual account has been added to one or more security groups, it no longer belongs to the default groups (local or domain admins).</span></span>

<span data-ttu-id="363e1-130">次の表は、仮想アカウントに対して構成できるオプションとその結果として与えられるアクセス許可をまとめたものです。</span><span class="sxs-lookup"><span data-stu-id="363e1-130">The following table summarizes the possible configuration options and resulting permissions for virtual accounts:</span></span>

|        <span data-ttu-id="363e1-131">コンピューターの種類</span><span class="sxs-lookup"><span data-stu-id="363e1-131">Computer type</span></span>         | <span data-ttu-id="363e1-132">仮想アカウント グループ構成</span><span class="sxs-lookup"><span data-stu-id="363e1-132">Virtual account group configuration</span></span> |                   <span data-ttu-id="363e1-133">ローカル ユーザー コンテキスト</span><span class="sxs-lookup"><span data-stu-id="363e1-133">Local user context</span></span>                    | <span data-ttu-id="363e1-134">ネットワーク ユーザー コンテキスト</span><span class="sxs-lookup"><span data-stu-id="363e1-134">Network user context</span></span> |
| ---------------------------- | ----------------------------------- | ------------------------------------------------------- | -------------------- |
| <span data-ttu-id="363e1-135">ドメイン コントローラー</span><span class="sxs-lookup"><span data-stu-id="363e1-135">Domain controller</span></span>            | <span data-ttu-id="363e1-136">既定</span><span class="sxs-lookup"><span data-stu-id="363e1-136">Default</span></span>                             | <span data-ttu-id="363e1-137">ドメイン ユーザー、'*DOMAIN*\Domain Admins' のメンバー</span><span class="sxs-lookup"><span data-stu-id="363e1-137">Domain user, member of '*DOMAIN*\Domain Admins'</span></span>         | <span data-ttu-id="363e1-138">コンピューター アカウント</span><span class="sxs-lookup"><span data-stu-id="363e1-138">Computer account</span></span>     |
| <span data-ttu-id="363e1-139">ドメイン コントローラー</span><span class="sxs-lookup"><span data-stu-id="363e1-139">Domain controller</span></span>            | <span data-ttu-id="363e1-140">ドメイン グループ A と B</span><span class="sxs-lookup"><span data-stu-id="363e1-140">Domain groups A and B</span></span>               | <span data-ttu-id="363e1-141">ドメイン ユーザー、'*DOMAIN*\A'、'*DOMAIN*\B' のメンバー</span><span class="sxs-lookup"><span data-stu-id="363e1-141">Domain user, member of '*DOMAIN*\A', '*DOMAIN*\B'</span></span>       | <span data-ttu-id="363e1-142">コンピューター アカウント</span><span class="sxs-lookup"><span data-stu-id="363e1-142">Computer account</span></span>     |
| <span data-ttu-id="363e1-143">メンバー サーバーまたはワークステーション</span><span class="sxs-lookup"><span data-stu-id="363e1-143">Member server or workstation</span></span> | <span data-ttu-id="363e1-144">既定</span><span class="sxs-lookup"><span data-stu-id="363e1-144">Default</span></span>                             | <span data-ttu-id="363e1-145">ローカル ユーザー、'*BUILTIN*\Administrators' のメンバー</span><span class="sxs-lookup"><span data-stu-id="363e1-145">Local user, member of '*BUILTIN*\Administrators'</span></span>        | <span data-ttu-id="363e1-146">コンピューター アカウント</span><span class="sxs-lookup"><span data-stu-id="363e1-146">Computer account</span></span>     |
| <span data-ttu-id="363e1-147">メンバー サーバーまたはワークステーション</span><span class="sxs-lookup"><span data-stu-id="363e1-147">Member server or workstation</span></span> | <span data-ttu-id="363e1-148">ローカル グループ C と D</span><span class="sxs-lookup"><span data-stu-id="363e1-148">Local groups C and D</span></span>                | <span data-ttu-id="363e1-149">ローカル ユーザー、'*COMPUTER*\C' と '*COMPUTER*\D' のメンバー</span><span class="sxs-lookup"><span data-stu-id="363e1-149">Local user, member of '*COMPUTER*\C' and '*COMPUTER*\D'</span></span> | <span data-ttu-id="363e1-150">コンピューター アカウント</span><span class="sxs-lookup"><span data-stu-id="363e1-150">Computer account</span></span>     |

<span data-ttu-id="363e1-151">セキュリティ監査イベントとアプリケーション イベントのログを見ると、各 JEA ユーザー セッションに一意の仮想アカウントが与えられていることがわかります。</span><span class="sxs-lookup"><span data-stu-id="363e1-151">When you look at security audit events and application event logs, you see that each JEA user session has a unique virtual account.</span></span> <span data-ttu-id="363e1-152">この一意のアカウントを使用すると、JEA エンドポイントのユーザー アクションを、コマンドを実行した元のユーザーまでさかのぼって追跡できます。</span><span class="sxs-lookup"><span data-stu-id="363e1-152">This unique account helps you track user actions in a JEA endpoint back to the original user who ran the command.</span></span> <span data-ttu-id="363e1-153">仮想アカウント名は `WinRM Virtual Users\WinRM_VA_<ACCOUNTNUMBER>_<DOMAIN>_<sAMAccountName>` の形式に従います。たとえば、ドメイン **Contoso** 内のユーザー **Alice** が JEA エンドポイントのサービスを再開すると、サービス コントロール マネージャー イベントに関連付けられたユーザー名は `WinRM Virtual Users\WinRM_VA_1_contoso_alice` になります。</span><span class="sxs-lookup"><span data-stu-id="363e1-153">Virtual account names follow the format `WinRM Virtual Users\WinRM_VA_<ACCOUNTNUMBER>_<DOMAIN>_<sAMAccountName>` For example, if user **Alice** in domain **Contoso** restarts a service in a JEA endpoint, the username associated with any service control manager events would be `WinRM Virtual Users\WinRM_VA_1_contoso_alice`.</span></span>

<span data-ttu-id="363e1-154">**グループの管理されたサービス アカウント (gMSAs)** は、メンバー サーバーに JEA セッションのネットワーク リソースのアクセス許可を与える必要があるときに便利です。</span><span class="sxs-lookup"><span data-stu-id="363e1-154">**Group-managed service accounts (gMSAs)** are useful when a member server needs to have access to network resources in the JEA session.</span></span> <span data-ttu-id="363e1-155">たとえば、JEA エンドポイントを使用して別のマシン上でホストされている REST API サービスへのアクセスを制御する場合などです。</span><span class="sxs-lookup"><span data-stu-id="363e1-155">For example, when a JEA endpoint is used to control access to a REST API service hosted on a different machine.</span></span> <span data-ttu-id="363e1-156">REST API を呼び出す関数を作成することは簡単ですが、API を使用して認証するにはネットワーク ID が必要です。</span><span class="sxs-lookup"><span data-stu-id="363e1-156">It's easy to write functions to invoke the REST APIs, but you need a network identity to authenticate with the API.</span></span> <span data-ttu-id="363e1-157">グループの管理されたサービス アカウントを使用すると、どのコンピューターからそのアカウントを使用できるかの制御を保持しながら、次ホップを実現できます。</span><span class="sxs-lookup"><span data-stu-id="363e1-157">Using a group-managed service account makes the second hop possible while maintaining control over which computers can use the account.</span></span> <span data-ttu-id="363e1-158">gMSA の効果的なアクセス許可が、gMSA アカウントが属するセキュリティ グループ (ローカルまたはドメイン) により定義されます。</span><span class="sxs-lookup"><span data-stu-id="363e1-158">The effective permissions of the gMSA are defined by the security groups (local or domain) to which the gMSA account belongs.</span></span>

<span data-ttu-id="363e1-159">JEA エンドポイントが gMSA を使用するように構成されている場合、すべての JEA ユーザーのアクションは同じ gMSA から行われているように見えます。</span><span class="sxs-lookup"><span data-stu-id="363e1-159">When a JEA endpoint is configured to use a gMSA, the actions of all JEA users appear to come from the same gMSA.</span></span> <span data-ttu-id="363e1-160">アクションを特定のユーザーまでさかのぼって追跡する唯一の方法は、PowerShell セッション トランスクリプトで実行されたコマンド セットを特定することです。</span><span class="sxs-lookup"><span data-stu-id="363e1-160">The only way to trace actions back to a specific user is to identify the set of commands run in a PowerShell session transcript.</span></span>

<span data-ttu-id="363e1-161">**実行**アカウントを指定しない場合、**パススルー資格情報**が使用されます。</span><span class="sxs-lookup"><span data-stu-id="363e1-161">**Pass-thru credentials** are used when you don't specify a **run-as** account.</span></span> <span data-ttu-id="363e1-162">PowerShell では、リモート サーバー上のコマンド実行に接続ユーザーの資格情報が使用されます。</span><span class="sxs-lookup"><span data-stu-id="363e1-162">PowerShell uses the connecting user's credential to run commands on the remote server.</span></span> <span data-ttu-id="363e1-163">これには、特権管理グループへの直接アクセスを接続ユーザーに許可する必要があります。</span><span class="sxs-lookup"><span data-stu-id="363e1-163">This requires you to grant the connecting user direct access to privileged management groups.</span></span> <span data-ttu-id="363e1-164">この構成は、JEA には**推奨されません**。</span><span class="sxs-lookup"><span data-stu-id="363e1-164">This configuration is **not** recommended for JEA.</span></span> <span data-ttu-id="363e1-165">接続ユーザーに管理者特権が既に与えられている場合、JEA を回避し、制約のない他の手法でシステムを管理できます。</span><span class="sxs-lookup"><span data-stu-id="363e1-165">If the connecting user already has admin privileges, they can avoid JEA and manage the system via other, unconstrained means.</span></span> <span data-ttu-id="363e1-166">詳細については、[JEA で管理者に対する防御がない](#jea-doesnt-protect-against-admins)ことに関する下のセクションをご覧ください。</span><span class="sxs-lookup"><span data-stu-id="363e1-166">For more information, see the section below on how [JEA doesn't protect against admins](#jea-doesnt-protect-against-admins).</span></span>

<span data-ttu-id="363e1-167">**標準の実行アカウント**では、PowerShell セッション全体を実行するユーザー アカウントを指定できます。</span><span class="sxs-lookup"><span data-stu-id="363e1-167">**Standard run-as accounts** allow you to specify any user account under which the entire PowerShell session runs.</span></span> <span data-ttu-id="363e1-168">(`-RunAsCredential` パラメーターを使用した) 固定の**実行**アカウントを使用したセッション構成は、JEA 対応ではありません。</span><span class="sxs-lookup"><span data-stu-id="363e1-168">Session configurations using fixed **run-as** accounts (with the `-RunAsCredential` parameter) aren't JEA-aware.</span></span> <span data-ttu-id="363e1-169">ロール定義は、期待どおりに機能しなくなります。</span><span class="sxs-lookup"><span data-stu-id="363e1-169">Role definitions no longer function as expected.</span></span> <span data-ttu-id="363e1-170">エンドポイントへのアクセスが承認されているすべてのユーザーに、同じロールが割り当てられます。</span><span class="sxs-lookup"><span data-stu-id="363e1-170">Every user authorized to access the endpoint is assigned the same role.</span></span>

<span data-ttu-id="363e1-171">JEA エンドポイント上では **RunAsCredential** を使用するべきではありません。アクションを特定のユーザーまでさかのぼって追跡することが困難であり、ユーザーをロールにマップするためのサポートが欠けているためです。</span><span class="sxs-lookup"><span data-stu-id="363e1-171">You shouldn't use a **RunAsCredential** on a JEA endpoint because it's difficult to trace actions back to specific users and lacks support for mapping users to roles.</span></span>

## <a name="winrm-endpoint-acl"></a><span data-ttu-id="363e1-172">WinRM エンドポイント ACL</span><span class="sxs-lookup"><span data-stu-id="363e1-172">WinRM Endpoint ACL</span></span>

<span data-ttu-id="363e1-173">通常の PowerShell リモート処理エンドポイントと同様に、各 JEA エンドポイントに個別のアクセス制御リスト (ACL) が与えられます。そのリストにより、JEA エンドポイントで認証できるユーザーを制御します。</span><span class="sxs-lookup"><span data-stu-id="363e1-173">As with regular PowerShell remoting endpoints, each JEA endpoint has a separate access control list (ACL) that controls who can authenticate with the JEA endpoint.</span></span> <span data-ttu-id="363e1-174">構成が不適切な場合、信頼されているユーザーが JEA エンドポイントにアクセスできなかったり、信頼されていないユーザーがアクセスできたりすることがあります。</span><span class="sxs-lookup"><span data-stu-id="363e1-174">If improperly configured, trusted users may not be able to access the JEA endpoint and untrusted users may have access.</span></span> <span data-ttu-id="363e1-175">WinRM ACL は JEA ロールへのユーザーのマッピングに影響を与えません。</span><span class="sxs-lookup"><span data-stu-id="363e1-175">The WinRM ACL doesn't affect the mapping of users to JEA roles.</span></span> <span data-ttu-id="363e1-176">マッピングは、エンドポイントの登録に使用されるセッション構成ファイル内の **RoleDefinitions** フィールドによって制御されます。</span><span class="sxs-lookup"><span data-stu-id="363e1-176">Mapping is controlled by the **RoleDefinitions** field in the session configuration file used to register the endpoint.</span></span>

<span data-ttu-id="363e1-177">既定では、JEA エンドポイントに複数のロール機能がある場合、WinRM ACL はすべてのマップされたユーザーにアクセスを許可するように構成されています。</span><span class="sxs-lookup"><span data-stu-id="363e1-177">By default, when a JEA endpoint has multiple role capabilities, the WinRM ACL is configured to allow access to all mapped users.</span></span> <span data-ttu-id="363e1-178">たとえば、次のコマンドを使用して構成された JEA セッションでは、`CONTOSO\JEA_Lev1` と `CONTOSO\JEA_Lev2` にフル アクセスが許可されます。</span><span class="sxs-lookup"><span data-stu-id="363e1-178">For example, a JEA session configured using the following commands grants full access to `CONTOSO\JEA_Lev1` and `CONTOSO\JEA_Lev2`.</span></span>

```powershell
$roles = @{ 'CONTOSO\JEA_Lev1' = 'Lev1Role'; 'CONTOSO\JEA_Lev2' = 'Lev2Role' }
New-PSSessionConfigurationFile -Path '.\jea.pssc' -SessionType RestrictedRemoteServer -RoleDefinitions $roles -RunAsVirtualAccount
Register-PSSessionConfiguration -Path '.\jea.pssc' -Name 'MyJEAEndpoint'
```

<span data-ttu-id="363e1-179">[Get-PSSessionConfiguration](/powershell/module/microsoft.powershell.core/get-pssessionconfiguration) コマンドレットでユーザー アクセス許可を監査できます。</span><span class="sxs-lookup"><span data-stu-id="363e1-179">You can audit user permissions with the [Get-PSSessionConfiguration](/powershell/module/microsoft.powershell.core/get-pssessionconfiguration) cmdlet.</span></span>

```powershell
Get-PSSessionConfiguration -Name 'MyJEAEndpoint' | Select-Object Permission
```

```Output
Permission
----------
CONTOSO\JEA_Lev1 AccessAllowed
CONTOSO\JEA_Lev2 AccessAllowed
```

<span data-ttu-id="363e1-180">アクセスを与えるユーザーを変更するには、対話的プロンプトの `Set-PSSessionConfiguration -Name 'MyJEAEndpoint' -ShowSecurityDescriptorUI` を実行するか、`Set-PSSessionConfiguration -Name 'MyJEAEndpoint' -SecurityDescriptorSddl <SDDL string>` を実行してアクセス許可を更新します。</span><span class="sxs-lookup"><span data-stu-id="363e1-180">To change which users have access, run either `Set-PSSessionConfiguration -Name 'MyJEAEndpoint' -ShowSecurityDescriptorUI` for an interactive prompt or `Set-PSSessionConfiguration -Name 'MyJEAEndpoint' -SecurityDescriptorSddl <SDDL string>` to update the permissions.</span></span> <span data-ttu-id="363e1-181">ユーザーが JEA エンドポイントにアクセスするには、少なくとも*呼び出し*権限が必要になります。</span><span class="sxs-lookup"><span data-stu-id="363e1-181">Users need at least *Invoke* rights to access the JEA endpoint.</span></span>

<span data-ttu-id="363e1-182">アクセス権を持つすべてのユーザーに定義済みのロールをマップしない JEA エンドポイントを作成できます。</span><span class="sxs-lookup"><span data-stu-id="363e1-182">It's possible to create a JEA endpoint that doesn't map a defined role to every user that has access.</span></span> <span data-ttu-id="363e1-183">これらのユーザーは JEA セッションを開始できますが、既定のコマンドレットにのみアクセスできます。</span><span class="sxs-lookup"><span data-stu-id="363e1-183">These users can start a JEA session, but only have access to the default cmdlets.</span></span> <span data-ttu-id="363e1-184">`Get-PSSessionCapability` を実行し、JEA エンドポイントのユーザー アクセス許可を監査できます。</span><span class="sxs-lookup"><span data-stu-id="363e1-184">You can audit user permissions in a JEA endpoint by running `Get-PSSessionCapability`.</span></span> <span data-ttu-id="363e1-185">詳細については、「[JEA の監査とレポート](audit-and-report.md)」を参照してください。</span><span class="sxs-lookup"><span data-stu-id="363e1-185">For more information, see [Auditing and Reporting on JEA](audit-and-report.md).</span></span>

## <a name="least-privilege-roles"></a><span data-ttu-id="363e1-186">最小特権ロール</span><span class="sxs-lookup"><span data-stu-id="363e1-186">Least privilege roles</span></span>

<span data-ttu-id="363e1-187">JEA ロールを設計するとき、バックグラウンドで実行されている仮想アカウントおよびグループの管理されたサービス アカウントに、ローカル コンピューターへのアクセスが無制限で与えられる可能性があることに注意してください。</span><span class="sxs-lookup"><span data-stu-id="363e1-187">When designing JEA roles, it's important to remember that the virtual and group-managed service accounts running behind the scenes can have unrestricted access to the local machine.</span></span> <span data-ttu-id="363e1-188">JEA のロール機能は、その特権コンテキストで実行できるコマンドとアプリケーションを制限するために役立ちます。</span><span class="sxs-lookup"><span data-stu-id="363e1-188">JEA role capabilities help limit the commands and applications that can be run in that privileged context.</span></span>
<span data-ttu-id="363e1-189">ロールが不適切に設計されると、危険なコマンドが許可され、ユーザーが JEA の境界から抜けたり、機密情報にアクセスできたりすることがあります。</span><span class="sxs-lookup"><span data-stu-id="363e1-189">Improperly designed roles can allow dangerous commands that may permit a user to break out of the JEA boundaries or obtain access to sensitive information.</span></span>

<span data-ttu-id="363e1-190">たとえば、次のロール機能エントリを考慮してください。</span><span class="sxs-lookup"><span data-stu-id="363e1-190">For example, consider the following role capability entry:</span></span>

```powershell
@{
    VisibleCmdlets = 'Microsoft.PowerShell.Management\*-Process'
}
```

<span data-ttu-id="363e1-191">このロール機能では、**Microsoft.PowerShell.Management** モジュールから名詞 **Process** であらゆる PowerShell コマンドレットを実行できます。</span><span class="sxs-lookup"><span data-stu-id="363e1-191">This role capability allows users to run any PowerShell cmdlet with the noun **Process** from the **Microsoft.PowerShell.Management** module.</span></span> <span data-ttu-id="363e1-192">システムで実行中のアプリケーションを確認するための `Get-Process` や、応答していないアプリケーションを強制終了するための `Stop-Process` のようなコマンドレットが、必要になることがあります。</span><span class="sxs-lookup"><span data-stu-id="363e1-192">Users may need to access cmdlets like `Get-Process` to see what applications are running on the system and `Stop-Process` to kill applications that aren't responding.</span></span> <span data-ttu-id="363e1-193">ただし、このエントリでは `Start-Process` も許可されます。これを利用すれば、完全な管理者権限で任意のプログラムを起動できます。</span><span class="sxs-lookup"><span data-stu-id="363e1-193">However, this entry also allows `Start-Process`, which can be used to start up an arbitrary program with full administrator permissions.</span></span> <span data-ttu-id="363e1-194">このプログラムをシステムのローカルにインストールする必要はありません。</span><span class="sxs-lookup"><span data-stu-id="363e1-194">The program doesn't need to be installed locally on the system.</span></span> <span data-ttu-id="363e1-195">接続されたユーザーは、ユーザーにローカル管理者特権を与え、マルウェアを実行するなど、ファイル共有からプログラムを起動する可能性があります。</span><span class="sxs-lookup"><span data-stu-id="363e1-195">A connected user could start a program from a file share that gives the user local admin privileges, runs malware, and more.</span></span>

<span data-ttu-id="363e1-196">次は、同じロール機能をより安全にしたものです。</span><span class="sxs-lookup"><span data-stu-id="363e1-196">A more secure version of this same role capability would look like:</span></span>

```powershell
@{
    VisibleCmdlets = 'Microsoft.PowerShell.Management\Get-Process', 'Microsoft.PowerShell.Management\Stop-Process'
}
```

<span data-ttu-id="363e1-197">ロールの機能にワイルドカードを使用しないでください。</span><span class="sxs-lookup"><span data-stu-id="363e1-197">Avoid using wildcards in role capabilities.</span></span> <span data-ttu-id="363e1-198">定期的に[有効なユーザー アクセス許可](audit-and-report.md#check-effective-rights-for-a-specific-user)を監査して、どのコマンドがユーザーにアクセスできるかを把握してください。</span><span class="sxs-lookup"><span data-stu-id="363e1-198">Be sure to regularly [audit effective user permissions](audit-and-report.md#check-effective-rights-for-a-specific-user) to understand which commands are accessible to the user.</span></span>

## <a name="jea-doesnt-protect-against-admins"></a><span data-ttu-id="363e1-199">JEA には管理者に対する防御がない</span><span class="sxs-lookup"><span data-stu-id="363e1-199">JEA doesn't protect against admins</span></span>

<span data-ttu-id="363e1-200">JEA の中心的原則の 1 つは、管理者以外のユーザーに一部の管理者タスクの実行を許可するというものです。</span><span class="sxs-lookup"><span data-stu-id="363e1-200">One of the core principles of JEA is that it allows non-admins to do some admin tasks.</span></span> <span data-ttu-id="363e1-201">JEA には、管理者特権が既に与えられているユーザーに対する防御がありません。</span><span class="sxs-lookup"><span data-stu-id="363e1-201">JEA doesn't protect against users who already have administrator privileges.</span></span> <span data-ttu-id="363e1-202">**Domain Admins**、ローカルの **Administrators**、またはその他の特権の高いグループに属するユーザーは、別の方法で JEA の防御を回避することができます。</span><span class="sxs-lookup"><span data-stu-id="363e1-202">Users who belong **Domain Admins**, local **Administrators**, or other highly privileged groups can circumvent JEA's protections via another means.</span></span> <span data-ttu-id="363e1-203">たとえば、RDP でサインインし、リモート MMC コンソールを利用したり、制約のない PowerShell エンドポイントに接続したりする可能性があります。</span><span class="sxs-lookup"><span data-stu-id="363e1-203">For example, they could sign in with RDP, use remote MMC consoles, or connect to unconstrained PowerShell endpoints.</span></span> <span data-ttu-id="363e1-204">また、システムのローカル管理者は JEA 構成を変更し、追加ユーザーを許可したり、ロール機能を変更し、JEA セッションでユーザーに許可する範囲を拡大することを許可したりできます。</span><span class="sxs-lookup"><span data-stu-id="363e1-204">Also, local admins on a system can modify JEA configurations to allow additional users or change a role capability to extend the scope of what a user can do in their JEA session.</span></span> <span data-ttu-id="363e1-205">JEA ユーザーのアクセス権の拡大状況を見て、システムの特権アクセスを得る他の手法がないか調べることが重要です。</span><span class="sxs-lookup"><span data-stu-id="363e1-205">It's important to evaluate your JEA users' extended permissions to see if there are other ways to gain privileged access to the system.</span></span>

<span data-ttu-id="363e1-206">一般的な慣行としては、日常的な保守管理に JEA を利用し、just-in-time (必要なときに必要な許可だけを与える) の特権アクセス管理ソリューションを用意して緊急の場合にのみ一時的にローカル管理者になることをユーザーに許可します。</span><span class="sxs-lookup"><span data-stu-id="363e1-206">A common practice is to use JEA for regular day-to-day maintenance and have a just-in-time, privileged access management solution that allows users to temporarily become local admins in emergency situations.</span></span> <span data-ttu-id="363e1-207">ユーザーはシステムの常駐管理者ではなくなるが、必要なときにのみ、管理者特権が与えられます。ワークフローを完了すると、アクセス許可の使用が記録されます。</span><span class="sxs-lookup"><span data-stu-id="363e1-207">This helps ensure users aren't permanent admins on the system, but can get those rights if, and only when, they complete a workflow that documents their use of those permissions.</span></span>
