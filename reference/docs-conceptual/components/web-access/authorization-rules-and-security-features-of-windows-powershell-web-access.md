---
ms.date: 06/27/2017
keywords: powershell,コマンドレット
title: Windows PowerShell Web Access の承認規則とセキュリティ機能
ms.openlocfilehash: ee25df052994e47e559daa87b89af813471d896b
ms.sourcegitcommit: 6545c60578f7745be015111052fd7769f8289296
ms.translationtype: HT
ms.contentlocale: ja-JP
ms.lasthandoff: 04/22/2020
ms.locfileid: "81624756"
---
# <a name="authorization-rules-and-security-features-of-windows-powershell-web-access"></a><span data-ttu-id="bb750-103">Windows PowerShell Web Access の承認規則とセキュリティ機能</span><span class="sxs-lookup"><span data-stu-id="bb750-103">Authorization Rules and Security Features of Windows PowerShell Web Access</span></span>

<span data-ttu-id="bb750-104">更新:2013 年 6 月 24 日</span><span class="sxs-lookup"><span data-stu-id="bb750-104">Updated: June 24, 2013</span></span>

<span data-ttu-id="bb750-105">適用先:Windows Server 2012 R2、Windows Server 2012</span><span class="sxs-lookup"><span data-stu-id="bb750-105">Applies To: Windows Server 2012 R2, Windows Server 2012</span></span>

<span data-ttu-id="bb750-106">Windows Server 2012 R2 および Windows Server 2012 の Windows PowerShell Web Access のセキュリティ モデルには制限があります。</span><span class="sxs-lookup"><span data-stu-id="bb750-106">Windows PowerShell Web Access in Windows Server 2012 R2 and Windows Server 2012 has a restrictive security model.</span></span> <span data-ttu-id="bb750-107">ユーザーが Windows PowerShell Web Access ゲートウェイにサインインし、Web ベースの Windows PowerShell コンソールを使用するには、アクセス許可が明示的に付与されている必要があります。</span><span class="sxs-lookup"><span data-stu-id="bb750-107">Users must explicitly be granted access before they can sign in to the Windows PowerShell Web Access gateway and use the web-based Windows PowerShell console.</span></span>

## <a name="configuring-authorization-rules-and-site-security"></a><span data-ttu-id="bb750-108">承認規則とサイト セキュリティの構成</span><span class="sxs-lookup"><span data-stu-id="bb750-108">Configuring authorization rules and site security</span></span>

<span data-ttu-id="bb750-109">Windows PowerShell Web Access をインストールし、ゲートウェイを構成すると、ユーザーがブラウザーでサインイン ページを開けるようになります。ただし、Windows PowerShell Web Access 管理者によってアクセスを明示的に許可されない限りサインインできません。</span><span class="sxs-lookup"><span data-stu-id="bb750-109">After Windows PowerShell Web Access is installed and the gateway is configured, users can open the sign-in page in a browser, but they cannot sign in until the Windows PowerShell Web Access administrator grants users access explicitly.</span></span> <span data-ttu-id="bb750-110">Windows PowerShell Web Access のアクセス制御は、次の表に示す一連の Windows PowerShell コマンドレットによって管理します。</span><span class="sxs-lookup"><span data-stu-id="bb750-110">'Windows PowerShell Web Access' access control is managed by using the set of Windows PowerShell cmdlets described in the following table.</span></span> <span data-ttu-id="bb750-111">承認規則の追加と管理に関しては、相当する GUI はありません。</span><span class="sxs-lookup"><span data-stu-id="bb750-111">There is no comparable GUI for adding or managing authorization rules.</span></span>
<span data-ttu-id="bb750-112">「[Windows PowerShell Web Access のコマンドレット](/powershell/module/powershellwebaccess/?view=winserver2012r2-ps)」を参照してください。</span><span class="sxs-lookup"><span data-stu-id="bb750-112">See [Windows PowerShell Web Access Cmdlets](/powershell/module/powershellwebaccess/?view=winserver2012r2-ps).</span></span>

<span data-ttu-id="bb750-113">管理者は、Windows PowerShell Web Access に対して `{0-n}` 個の認証規則を定義できます。</span><span class="sxs-lookup"><span data-stu-id="bb750-113">Administrators can define `{0-n}` authentication rules for Windows PowerShell Web Access.</span></span> <span data-ttu-id="bb750-114">既定のセキュリティは、許容的ではなく制限的なものになります。認証規則がゼロの場合には、すべてのユーザーがすべてのアクセスを禁止されます。</span><span class="sxs-lookup"><span data-stu-id="bb750-114">The default security is restrictive rather than permissive; zero authentication rules means no users have access to anything.</span></span>

<span data-ttu-id="bb750-115">Windows Server 2012 R2 の [Add-PswaAuthorizationRule と](/powershell/module/powershellwebaccess/add-pswaauthorizationrule?view=winserver2012r2-ps)[Test-PswaAuthorizationRule](/powershell/module/powershellwebaccess/test-pswaauthorizationrule?view=winserver2012r2-ps) に、リモート コンピューターから、またはアクティブな Windows PowerShell Web Access セッション内から Windows PowerShell Web Access 承認規則を追加し、テストできるようにするために、資格情報パラメーターが用意されました。</span><span class="sxs-lookup"><span data-stu-id="bb750-115">[Add-PswaAuthorizationRule](/powershell/module/powershellwebaccess/add-pswaauthorizationrule?view=winserver2012r2-ps) and [Test-PswaAuthorizationRule](/powershell/module/powershellwebaccess/test-pswaauthorizationrule?view=winserver2012r2-ps) in Windows Server 2012 R2 include a Credential parameter that allows you to add and test Windows PowerShell Web Access authorization rules from a remote computer, or from within an active Windows PowerShell Web Access session.</span></span> <span data-ttu-id="bb750-116">資格情報パラメーターを持つ他の Windows PowerShell コマンドレットと同様、PSCredential オブジェクトをパラメーターの値として指定できます。</span><span class="sxs-lookup"><span data-stu-id="bb750-116">As with other Windows PowerShell cmdlets that have a Credential parameter, you can specify a PSCredential object as the value of the parameter.</span></span> <span data-ttu-id="bb750-117">リモート コンピューターに渡す資格情報を含む PSCredential オブジェクトを作成するには、[Get-Credential](/powershell/module/microsoft.powershell.security/Get-Credential) コマンドレットを実行します。</span><span class="sxs-lookup"><span data-stu-id="bb750-117">To create a PSCredential object that contains credentials you want to pass to a remote computer, run the [Get-Credential](/powershell/module/microsoft.powershell.security/Get-Credential) cmdlet.</span></span>

<span data-ttu-id="bb750-118">Windows PowerShell Web Access の認証規則はホワイトリスト方式です。</span><span class="sxs-lookup"><span data-stu-id="bb750-118">Windows PowerShell Web Access authentication rules are whitelist rules.</span></span> <span data-ttu-id="bb750-119">各規則は、ユーザー、ターゲット コンピューター、および指定されたターゲット コンピューターにおける特定の Windows PowerShell [セッション構成](/powershell/module/microsoft.powershell.core/about/about_session_configurations?view=powershell-5.1) (エンドポイントまたは_実行空間_とも呼ばれます) の間に許可される接続を定義したものです。</span><span class="sxs-lookup"><span data-stu-id="bb750-119">Each rule is a definition of an allowed connection between users, target computers, and particular Windows PowerShell [session configurations](/powershell/module/microsoft.powershell.core/about/about_session_configurations?view=powershell-5.1) (also referred to as endpoints or _runspaces_) on specified target computers.</span></span>
<span data-ttu-id="bb750-120">**実行空間**の説明については、「[PowerShell 実行空間の使用を開始する) を参照してください](https://blogs.technet.microsoft.com/heyscriptingguy/2015/11/26/beginning-use-of-powershell-runspaces-part-1/)」</span><span class="sxs-lookup"><span data-stu-id="bb750-120">For an explanation on **runspaces** see [Beginning Use of PowerShell Runspaces](https://blogs.technet.microsoft.com/heyscriptingguy/2015/11/26/beginning-use-of-powershell-runspaces-part-1/)</span></span>

> [!IMPORTANT]
> <span data-ttu-id="bb750-121">アクセスを許可されるためにユーザーが従う必要がある規則は 1 つだけです。</span><span class="sxs-lookup"><span data-stu-id="bb750-121">A user needs only one rule to be true to get access.</span></span> <span data-ttu-id="bb750-122">1 つのコンピューターに対する全言語でのアクセス、または Windows PowerShell リモート管理コマンドレットだけに対するアクセスを許可されているユーザーは、Web ベース コンソールから、最初のターゲット コンピューターに接続されているその他のコンピューターにログオン (ホップ) できます。</span><span class="sxs-lookup"><span data-stu-id="bb750-122">If a user is given access to one computer with either full language access or access only to Windows PowerShell remote management cmdlets, from the web-based console, the user can log on (or hop) to other computers that are connected to the first target computer.</span></span> <span data-ttu-id="bb750-123">Windows PowerShell Web Access の最も安全な構成方法は、制約付きセッション構成に対するアクセスだけを許可し、通常リモートでの実行が必要になる特定のタスクを完了できるようにする方法です。</span><span class="sxs-lookup"><span data-stu-id="bb750-123">The most secure way to configure Windows PowerShell Web Access is to allow users access only to constrained session configurations that allow them to accomplish specific tasks that they normally need to perform remotely.</span></span>

<span data-ttu-id="bb750-124">[Windows PowerShell Web Access コマンドレット](/powershell/module/powershellwebaccess/?view=winserver2012r2-ps)で参照されるコマンドレットにより作成される一連のアクセス規則を利用し、Windows PowerShell Web Access ゲートウェイでユーザーを承認できます。</span><span class="sxs-lookup"><span data-stu-id="bb750-124">The cmdlets referenced in [Windows PowerShell Web Access Cmdlets](/powershell/module/powershellwebaccess/?view=winserver2012r2-ps) allow to create a set of access rules which are used to authorize a user on the Windows PowerShell Web Access gateway.</span></span> <span data-ttu-id="bb750-125">これらの規則は、対象コンピューター上のアクセス制御リスト (ACL) とは別に、Web アクセスに対する追加のセキュリティ層として機能します。</span><span class="sxs-lookup"><span data-stu-id="bb750-125">The rules are different from the access control lists (ACLs) on the destination computer, and provide an additional layer of security for web access.</span></span> <span data-ttu-id="bb750-126">以降のセクションでは、セキュリティについてさらに詳しく説明します。</span><span class="sxs-lookup"><span data-stu-id="bb750-126">More details about security are described in the following section.</span></span>

<span data-ttu-id="bb750-127">先に説明したセキュリティ層のいずれかを通過できない場合、ユーザーのブラウザー ウィンドウに通常の 'アクセス拒否' メッセージが表示されます。</span><span class="sxs-lookup"><span data-stu-id="bb750-127">If users cannot pass any of the preceding security layers, they receive a generic 'access denied' message in their browser windows.</span></span> <span data-ttu-id="bb750-128">ゲートウェイ サーバーには詳細なセキュリティ情報が記録されますが、エンド ユーザーに対しては、通過したセキュリティ層の数や、サインインまたは認証のエラーが発生した具体的な層などの情報は表示されません。</span><span class="sxs-lookup"><span data-stu-id="bb750-128">Although security details are logged on the gateway server, end users are not shown information about how many security layers they passed, or at which layer the sign-in or authentication failure occurred.</span></span>

<span data-ttu-id="bb750-129">承認規則の構成方法の詳細については、このトピックの「[承認規則の構成](#configuring-authorization-rules-and-site-security)」を参照してください。</span><span class="sxs-lookup"><span data-stu-id="bb750-129">For more information about configuring authorization rules, see [configuring authorization rules](#configuring-authorization-rules-and-site-security) in this topic.</span></span>

### <a name="security"></a><span data-ttu-id="bb750-130">Security</span><span class="sxs-lookup"><span data-stu-id="bb750-130">Security</span></span>

<span data-ttu-id="bb750-131">Windows PowerShell Web Access のセキュリティ モデルは、Web ベース コンソールのエンド ユーザーとターゲット コンピューターの間に 4 つの層を構成します。</span><span class="sxs-lookup"><span data-stu-id="bb750-131">The Windows PowerShell Web Access security model has four layers between an end user of the web-based console, and a target computer.</span></span> <span data-ttu-id="bb750-132">Windows PowerShell Web Access 管理者は、IIS マネージャー コンソールで構成を追加することで、セキュリティ層をさらに追加できます。</span><span class="sxs-lookup"><span data-stu-id="bb750-132">Windows PowerShell Web Access administrators can add security layers through additional configuration in the IIS Manager console.</span></span> <span data-ttu-id="bb750-133">IIS マネージャー コンソールで Web サイトを保護する方法について詳しくは、「[Web サーバーのセキュリティを構成する (IIS7)](https://technet.microsoft.com/library/cc731278)」をご覧ください。</span><span class="sxs-lookup"><span data-stu-id="bb750-133">For more information about securing websites in the IIS Manager console, see [Configure Web Server Security (IIS7)](https://technet.microsoft.com/library/cc731278).</span></span>

<span data-ttu-id="bb750-134">IIS のベスト プラクティスと、サービス拒否攻撃を阻止する方法の詳細については、[DoS/サービス拒否攻撃阻止のベスト プラクティスに関するページ](https://technet.microsoft.com/library/cc750213)を参照してください。</span><span class="sxs-lookup"><span data-stu-id="bb750-134">For more information about IIS best practices and preventing denial-of-service attacks, see [Best Practices for Preventing DoS/Denial of Service Attacks](https://technet.microsoft.com/library/cc750213).</span></span>
<span data-ttu-id="bb750-135">管理者は、市販の認証ソフトウェアを購入してインストールすることも可能です。</span><span class="sxs-lookup"><span data-stu-id="bb750-135">An administrator can also buy and install additional retail authentication software.</span></span>

<span data-ttu-id="bb750-136">エンド ユーザーとターゲット コンピューターの間に構成される 4 つの層を次の表に示します。</span><span class="sxs-lookup"><span data-stu-id="bb750-136">The following table describes the four layers of security between end users and target computers.</span></span>

|<span data-ttu-id="bb750-137">Level</span><span class="sxs-lookup"><span data-stu-id="bb750-137">Level</span></span>|<span data-ttu-id="bb750-138">レイヤー</span><span class="sxs-lookup"><span data-stu-id="bb750-138">Layer</span></span>|
|-|-|
|<span data-ttu-id="bb750-139">1</span><span class="sxs-lookup"><span data-stu-id="bb750-139">1</span></span>|[<span data-ttu-id="bb750-140">IIS Web サーバーのセキュリティ機能</span><span class="sxs-lookup"><span data-stu-id="bb750-140">iis web server security features</span></span>](#iis-web-server-security-features)|
|<span data-ttu-id="bb750-141">2</span><span class="sxs-lookup"><span data-stu-id="bb750-141">2</span></span>|[<span data-ttu-id="bb750-142">Windows PowerShell Web Access のフォーム ベースのゲートウェイ認証</span><span class="sxs-lookup"><span data-stu-id="bb750-142">windows powershell web access forms-based gateway authentication</span></span>](#windows-powershell-web-access-forms-based-gateway-authentication)|
|<span data-ttu-id="bb750-143">3</span><span class="sxs-lookup"><span data-stu-id="bb750-143">3</span></span>|[<span data-ttu-id="bb750-144">Windows PowerShell Web Access の承認規則</span><span class="sxs-lookup"><span data-stu-id="bb750-144">windows powershell web access authorization rules</span></span>](#windows-powershell-web-access-authorization-rules)|
|<span data-ttu-id="bb750-145">4</span><span class="sxs-lookup"><span data-stu-id="bb750-145">4</span></span>|[<span data-ttu-id="bb750-146">対象コンピューターでの認証と承認規則</span><span class="sxs-lookup"><span data-stu-id="bb750-146">target authentication and authorization rules</span></span>](#target-authentication-and-authorization-rules)|

<span data-ttu-id="bb750-147">各層に関する詳細は次の見出しの下にあります。</span><span class="sxs-lookup"><span data-stu-id="bb750-147">Detailed information about each layer can be found under the following headings:</span></span>

#### <a name="iis-web-server-security-features"></a><span data-ttu-id="bb750-148">IIS Web サーバーのセキュリティ機能</span><span class="sxs-lookup"><span data-stu-id="bb750-148">IIS Web Server security features</span></span>

<span data-ttu-id="bb750-149">Windows PowerShell Web Access のユーザーは、常にゲートウェイでユーザー名とパスワードを入力し、アカウントを認証する必要があります。</span><span class="sxs-lookup"><span data-stu-id="bb750-149">Windows PowerShell Web Access users must always provide a user name and password to authenticate their accounts on the gateway.</span></span> <span data-ttu-id="bb750-150">ただし Windows PowerShell Web Access 管理者は、クライアント証明書による認証をオプションで有効または無効にすることができます (テスト証明書を有効にする方法と、その後、本物の証明書を構成する方法については、「[Install and Use Windows PowerShell Web Access](install-and-use-windows-powershell-web-access.md)」(Windows PowerShell Web Access のインストールと使用) を参照してください)。</span><span class="sxs-lookup"><span data-stu-id="bb750-150">However, Windows PowerShell Web Access administrators can also turn optional client certificate authentication on or off, see [install and use windows powershell web access](install-and-use-windows-powershell-web-access.md) to enable a test certificate and, later, how to configure a genuine certificate).</span></span>

<span data-ttu-id="bb750-151">オプションのクライアント証明書機能は、Web サーバー (IIS) 構成の一環として、ユーザー名とパスワードに加えて有効なクライアント証明書の所有をエンド ユーザーに要求します。</span><span class="sxs-lookup"><span data-stu-id="bb750-151">The optional client certificate feature requires end users to have a valid client certificate, in addition to their user names and passwords, and is part of Web Server (IIS) configuration.</span></span> <span data-ttu-id="bb750-152">クライアント証明書の層が有効になっている場合、Windows PowerShell Web Access のサインイン ページは、サインイン資格情報を評価する前に、有効な証明書の提示を求めるメッセージをユーザーに表示します。</span><span class="sxs-lookup"><span data-stu-id="bb750-152">When the client certificate layer is enabled, the Windows PowerShell Web Access sign-in page prompts users to provide valid certificates before their sign-in credentials are evaluated.</span></span> <span data-ttu-id="bb750-153">クライアント証明書の認証によってクライアント証明書を自動的に確認します。</span><span class="sxs-lookup"><span data-stu-id="bb750-153">Client certificate authentication automatically checks for the client certificate.</span></span> <span data-ttu-id="bb750-154">有効な証明書が見つからない場合、Windows PowerShell Web Access は通知を表示し、ここでユーザーは証明書を提示できます。</span><span class="sxs-lookup"><span data-stu-id="bb750-154">If a valid certificate is not found, Windows PowerShell Web Access informs users, so they can provide the certificate.</span></span> <span data-ttu-id="bb750-155">有効な証明書が見つかった場合、Windows PowerShell Web Access はサインイン ページを表示し、ここでユーザーは名前とパスワードを入力できます。</span><span class="sxs-lookup"><span data-stu-id="bb750-155">If a valid client certificate is found, Windows PowerShell Web Access opens the sign-in page for users to provide their user names and passwords.</span></span>

<span data-ttu-id="bb750-156">これが、IIS Web サーバーが提供する追加のセキュリティ設定の 1 つの例です。</span><span class="sxs-lookup"><span data-stu-id="bb750-156">This is one example of additional security settings that are offered by IIS Web Server.</span></span> <span data-ttu-id="bb750-157">IIS が提供するその他のセキュリティ機能の詳細については、「[Configure Web Server Security (IIS 7) (Web サーバーのセキュリティを構成する (IIS 7))](https://technet.microsoft.com/library/cc731278)」を参照してください。</span><span class="sxs-lookup"><span data-stu-id="bb750-157">For more information about other IIS security features, see [Configure Web Server Security (IIS 7)](https://technet.microsoft.com/library/cc731278).</span></span>

#### <a name="windows-powershell-web-access-forms-based-gateway-authentication"></a><span data-ttu-id="bb750-158">Windows PowerShell Web Access のフォーム ベースのゲートウェイ認証</span><span class="sxs-lookup"><span data-stu-id="bb750-158">Windows PowerShell Web Access forms-based gateway authentication</span></span>

<span data-ttu-id="bb750-159">Windows PowerShell Web Access のサインイン ページは、一連の資格情報 (ユーザー名とパスワード) を要求すると共に、ターゲット コンピューターに対する別の資格情報を提示するためのオプションをユーザーに提供します。</span><span class="sxs-lookup"><span data-stu-id="bb750-159">The Windows PowerShell Web Access sign-in page requires a set of credentials (user name and password) and offers users the option of providing different credentials for the target computer.</span></span>
<span data-ttu-id="bb750-160">ユーザーがその他の資格情報を提示しない場合、ゲートウェイへの接続に使われるプライマリのユーザー名とパスワードが、ターゲット コンピューターへの接続にも使われます。</span><span class="sxs-lookup"><span data-stu-id="bb750-160">If the user does not provide alternate credentials, the primary user name and password that are used to connect to the gateway are also used to connect to the target computer.</span></span>

<span data-ttu-id="bb750-161">要求された資格情報は Windows PowerShell Web Access ゲートウェイで認証されます。</span><span class="sxs-lookup"><span data-stu-id="bb750-161">The required credentials are authenticated on the Windows PowerShell Web Access gateway.</span></span> <span data-ttu-id="bb750-162">これらの資格情報は、ローカルの Windows PowerShell Web Access ゲートウェイ サーバーまたは Active Directory の有効なユーザー アカウントである必要があります。</span><span class="sxs-lookup"><span data-stu-id="bb750-162">These credentials must be valid user accounts on either the local Windows PowerShell Web Access gateway server, or in Active Directory.</span></span>

#### <a name="windows-powershell-web-access-authorization-rules"></a><span data-ttu-id="bb750-163">Windows PowerShell Web Access の承認規則</span><span class="sxs-lookup"><span data-stu-id="bb750-163">Windows PowerShell Web Access authorization rules</span></span>

<span data-ttu-id="bb750-164">ゲートウェイでユーザーが認証されると、Windows PowerShell Web Access が承認規則を確認して、要求されたターゲット コンピューターへのアクセスがユーザーに許可されているかどうかを検証します。</span><span class="sxs-lookup"><span data-stu-id="bb750-164">After a user is authenticated at the gateway, Windows PowerShell Web Access checks authorization rules to verify if the user has access to the requested target computer.</span></span> <span data-ttu-id="bb750-165">問題なく承認されると、ユーザーの資格情報がターゲット コンピューターに渡されます。</span><span class="sxs-lookup"><span data-stu-id="bb750-165">After successful authorization, the user's credentials are passed along to the target computer.</span></span>

<span data-ttu-id="bb750-166">これらの規則の評価は常にゲートウェイでのユーザー認証の後で実行され、その後、ターゲット コンピューターでユーザー認証を実行できるようになります。</span><span class="sxs-lookup"><span data-stu-id="bb750-166">These rules are evaluated only after a user has been authenticated by the gateway, and before a user can be authenticated on a target computer.</span></span>

#### <a name="target-authentication-and-authorization-rules"></a><span data-ttu-id="bb750-167">対象コンピューターでの認証と承認規則</span><span class="sxs-lookup"><span data-stu-id="bb750-167">Target authentication and authorization rules</span></span>

<span data-ttu-id="bb750-168">Windows PowerShell Web Access におけるセキュリティの最後の層は、ターゲット コンピューター独自のセキュリティ構成です。</span><span class="sxs-lookup"><span data-stu-id="bb750-168">The final layer of security for Windows PowerShell Web Access is the target computer's own security configuration.</span></span> <span data-ttu-id="bb750-169">Windows PowerShell Web Access 経由でターゲット コンピューターを操作する Windows PowerShell Web ベース コンソールを実行するには、ユーザーは、ターゲット コンピューターと Windows PowerShell Web Access の承認規則でアクセス権を適切に構成する必要があります。</span><span class="sxs-lookup"><span data-stu-id="bb750-169">Users must have the appropriate access rights configured on the target computer, and also in the Windows PowerShell Web Access authorization rules, to run a Windows PowerShell web-based console that affects a target computer through Windows PowerShell Web Access.</span></span>

<span data-ttu-id="bb750-170">この層は、ユーザーが [Enter-PSSession](/powershell/module/microsoft.powershell.core/Enter-PSSession) または [New-PSSession](/powershell/module/microsoft.powershell.core/new-pssession) コマンドレットを実行して Windows PowerShell からターゲット コンピューターへのリモート Windows PowerShell セッション作成を試みた場合に、試行された接続を評価するのと同じセキュリティ メカニズムを提供します。</span><span class="sxs-lookup"><span data-stu-id="bb750-170">This layer offers the same security mechanisms that would evaluate connection attempts if users tried to create a remote Windows PowerShell session to a target computer from within Windows PowerShell by running the [Enter-PSSession](/powershell/module/microsoft.powershell.core/Enter-PSSession) or [New-PSSession](/powershell/module/microsoft.powershell.core/new-pssession) cmdlets.</span></span>

<span data-ttu-id="bb750-171">既定では、Windows PowerShell Web Access は、ゲートウェイとターゲット コンピューター両方での認証に、プライマリのユーザー名とパスワードを使います。</span><span class="sxs-lookup"><span data-stu-id="bb750-171">By default, Windows PowerShell Web Access uses the primary user name and password for authentication on both the gateway and the target computer.</span></span> <span data-ttu-id="bb750-172">Web ベースのサインイン ページでは、 **[オプションの接続設定]** というセクションで、必要に応じてターゲット コンピューターに対する別の資格情報を提示するためのオプションをユーザーに提供しています。</span><span class="sxs-lookup"><span data-stu-id="bb750-172">The web-based sign-in page, in a section titled **Optional connection settings**, offers users the option of providing different credentials for the target computer, if they are required.</span></span> <span data-ttu-id="bb750-173">ユーザーがその他の資格情報を提示しない場合、ゲートウェイへの接続に使われるプライマリのユーザー名とパスワードが、ターゲット コンピューターへの接続にも使われます。</span><span class="sxs-lookup"><span data-stu-id="bb750-173">If the user does not provide alternate credentials, the primary user name and password that are used to connect to the gateway are also used to connect to the target computer.</span></span>

<span data-ttu-id="bb750-174">承認規則を使って、特定のセッション構成に対するユーザーのアクセスを許可することができます。</span><span class="sxs-lookup"><span data-stu-id="bb750-174">Authorization rules can be used to allow users access to a particular session configuration.</span></span> <span data-ttu-id="bb750-175">担当者は、Windows PowerShell Web Access 用の_制限付き実行空間_またはセッション構成を作成し、特定のユーザーが特定のセッション構成だけにアクセスできるようにして、それらのユーザーを Windows PowerShell Web Access にサインインさせることができます。</span><span class="sxs-lookup"><span data-stu-id="bb750-175">You can create _restricted runspaces_ or session configurations for Windows PowerShell Web Access, and allow specific users to connect only to specific session configurations when they sign in to Windows PowerShell Web Access.</span></span> <span data-ttu-id="bb750-176">アクセス制御リスト (ACL) を使って特定のエンドポイントにアクセスできるユーザーを決定できることに加えて、このセクションで説明する承認規則を使用すると、エンドポイントへのアクセスを特定のユーザーにさらに制限することができます。</span><span class="sxs-lookup"><span data-stu-id="bb750-176">You can use access control lists (ACLs) to determine which users have access to specific endpoints, and further restrict access to the endpoint for a specific set of users by using authorization rules described in this section.</span></span> <span data-ttu-id="bb750-177">制限付き実行空間の詳細については、[制約付き実行空間の作成](/powershell/scripting/developer/hosting/creating-a-constrained-runspace)に関するページを参照してください。</span><span class="sxs-lookup"><span data-stu-id="bb750-177">For more information about restricted runspaces, see [Creating a constrained runspace](/powershell/scripting/developer/hosting/creating-a-constrained-runspace).</span></span>

### <a name="configuring-authorization-rules"></a><span data-ttu-id="bb750-178">承認規則の構成</span><span class="sxs-lookup"><span data-stu-id="bb750-178">Configuring authorization rules</span></span>

<span data-ttu-id="bb750-179">多くの場合、管理者が Windows PowerShell Web Access ユーザー用に必要とする承認規則は、環境内で Windows PowerShell のリモート管理用に定義されているものと同じになります。</span><span class="sxs-lookup"><span data-stu-id="bb750-179">Administrators likely want the same authorization rule for Windows PowerShell Web Access users that is already defined in their environment for Windows PowerShell remote management.</span></span> <span data-ttu-id="bb750-180">このセクションの最初の手順では、安全な承認規則を追加することによって、サインインして 1 つのセッション構成で 1 つのコンピューターを管理するためのアクセスを、ユーザー 1 人に許可する方法を説明します。</span><span class="sxs-lookup"><span data-stu-id="bb750-180">The first procedure in this section describes how to add a secure authorization rule that grants access to one user, signing in to manage one computer, and within a single session configuration.</span></span> <span data-ttu-id="bb750-181">2 つ目の手順では、不要になった承認規則を削除する方法について説明します。</span><span class="sxs-lookup"><span data-stu-id="bb750-181">The second procedure describes how to remove an authorization rule that is no longer needed.</span></span>

<span data-ttu-id="bb750-182">カスタム セッション構成を使用することで、特定のユーザーに対して Windows PowerShell Web Access の制限付き実行空間内でのみ作業することを許可する場合、カスタム セッション構成は、これらが参照される承認規則を追加する前に作成してください。</span><span class="sxs-lookup"><span data-stu-id="bb750-182">If you plan to use custom session configurations to allow specific users to work only within restricted runspaces in Windows PowerShell Web Access, create your custom session configurations before you add authorization rules that refer to them.</span></span> <span data-ttu-id="bb750-183">Windows PowerShell Web Access コマンドレットを使用してカスタム セッション構成を作成することはできません。</span><span class="sxs-lookup"><span data-stu-id="bb750-183">You cannot use the Windows PowerShell Web Access cmdlets to create custom session configurations.</span></span> <span data-ttu-id="bb750-184">カスタム セッション構成の作成方法について詳しくは、「[about_Session_Configuration_Files](/powershell/module/microsoft.powershell.core/about/about_session_configuration_files)」をご覧ください。</span><span class="sxs-lookup"><span data-stu-id="bb750-184">For more information about creating custom session configurations, see [about_Session_Configuration_Files](/powershell/module/microsoft.powershell.core/about/about_session_configuration_files).</span></span>

<span data-ttu-id="bb750-185">Windows PowerShell Web Access コマンドレットは、ワイルドカード文字、アスタリスク(\*) をサポートしています。</span><span class="sxs-lookup"><span data-stu-id="bb750-185">Windows PowerShell Web Access cmdlets support one wildcard character, an asterisk ( \* ).</span></span> <span data-ttu-id="bb750-186">文字列内のワイルドカード文字はサポートされていません。アスタリスクは、プロパティ (ユーザー、コンピューター、セッション構成) ごとに 1 つ使うことができます。</span><span class="sxs-lookup"><span data-stu-id="bb750-186">Wildcard characters within strings are not supported; use a single asterisk per property (users, computers, or session configurations).</span></span>

> [!NOTE]
> <span data-ttu-id="bb750-187">承認規則を使ってユーザーのアクセスを許可し、Windows PowerShell Web Access 環境のセキュリティ保護を実現するその他のさまざまな方法については、このトピックの「[承認規則のその他のシナリオの例](#other-authorization-rule-scenario-examples)」をご覧ください。</span><span class="sxs-lookup"><span data-stu-id="bb750-187">For more ways you can use authorization rules to grant access to users and help secure the Windows PowerShell Web Access environment, see [other authorization rule scenario examples](#other-authorization-rule-scenario-examples) in this topic.</span></span>

#### <a name="to-add-a-restrictive-authorization-rule"></a><span data-ttu-id="bb750-188">制限的な承認規則を追加するには</span><span class="sxs-lookup"><span data-stu-id="bb750-188">To add a restrictive authorization rule</span></span>

1. <span data-ttu-id="bb750-189">次のいずれかを実行して、管理者特権を使って Windows PowerShell セッションを開きます。</span><span class="sxs-lookup"><span data-stu-id="bb750-189">Do one of the following to open a Windows PowerShell session with elevated user rights.</span></span>

   - <span data-ttu-id="bb750-190">Windows デスクトップで、タスク バーの **[Windows PowerShell]** を右クリックし、 **[管理者として実行]** をクリックします。</span><span class="sxs-lookup"><span data-stu-id="bb750-190">On the Windows desktop, right-click **Windows PowerShell** on the taskbar, and then click **Run as Administrator**.</span></span>

   - <span data-ttu-id="bb750-191">Windows の**スタート**画面で、 **[Windows PowerShell]** を右クリックし、 **[管理者として実行]** をクリックします。</span><span class="sxs-lookup"><span data-stu-id="bb750-191">On the Windows **Start** screen, right-click **Windows PowerShell**, and then click **Run as Administrator**.</span></span>

2. <span data-ttu-id="bb750-192">セッションの構成を使用してユーザー アクセスを制限するための手順 (**省略可能**):</span><span class="sxs-lookup"><span data-stu-id="bb750-192">**Optional step** For restricting user access by using session configurations:</span></span>

   <span data-ttu-id="bb750-193">使用を希望するセッション構成が規則に既に存在することを確認します。</span><span class="sxs-lookup"><span data-stu-id="bb750-193">Verify that the session configurations that you want to use, already exist in your rules .</span></span>

   <span data-ttu-id="bb750-194">まだ作成されていない場合は、「[about_Session_Configuration_Files](/powershell/module/microsoft.powershell.core/about/about_session_configuration_files)」に記載されているセッション構成の作成手順を使用してください。</span><span class="sxs-lookup"><span data-stu-id="bb750-194">If they have not yet been created, use instructions for creating session configurations in [about_Session_Configuration_Files](/powershell/module/microsoft.powershell.core/about/about_session_configuration_files).</span></span>

3. <span data-ttu-id="bb750-195">この承認規則により、特定のユーザー 1 人が、通常アクセスが許可されているネットワーク上の 1 つのコンピューターにアクセスして、このユーザーが通常必要とするスクリプトとコマンドレットに制限された特定の 1 つのセッション構成にアクセスできるようになります。</span><span class="sxs-lookup"><span data-stu-id="bb750-195">This authorization rule allows a specific user access to one computer on the network to which they typically have access, with access to a specific session configuration that is scoped to the user's typical scripting and cmdlet needs.</span></span> <span data-ttu-id="bb750-196">次のように入力して **Enter** キーを押します。</span><span class="sxs-lookup"><span data-stu-id="bb750-196">Type the following, and then press **Enter**.</span></span>

   ```
   Add-PswaAuthorizationRule -UserName <domain\user | computer\user> `
      -ComputerName <computer_name> -ConfigurationName <session_configuration_name>
   ```

   - <span data-ttu-id="bb750-197">次の例では、_Contoso_ ドメインの _JSmith_ というユーザーに、_Contoso_214_ というコンピューターを管理し、_NewAdminsOnly_ というセッション構成を使うためのアクセス権が付与されます。</span><span class="sxs-lookup"><span data-stu-id="bb750-197">In the following example, a user named _JSmith_ in the _Contoso_ domain is granted access to manage the computer _Contoso_214_, and use a session configuration named _NewAdminsOnly_.</span></span>

   ```powershell
   Add-PswaAuthorizationRule -UserName 'Contoso\JSmith' `
      -ComputerName Contoso_214 -ConfigurationName NewAdminsOnly
   ```

4. <span data-ttu-id="bb750-198">**Get-PswaAuthorizationRule** コマンドレットまたは `Test-PswaAuthorizationRule -UserName <domain\user | computer\user> -ComputerName** <computer_name>` のいずれかを実行して、規則が作成されたことを検証します。</span><span class="sxs-lookup"><span data-stu-id="bb750-198">Verify that the rule has been created by running either the **Get-PswaAuthorizationRule** cmdlet, or `Test-PswaAuthorizationRule -UserName <domain\user | computer\user> -ComputerName** <computer_name>`.</span></span>
   <span data-ttu-id="bb750-199">たとえば、「 `Test-PswaAuthorizationRule -UserName Contoso\\JSmith -ComputerName Contoso_214` 」のように入力します。</span><span class="sxs-lookup"><span data-stu-id="bb750-199">For example, `Test-PswaAuthorizationRule -UserName Contoso\\JSmith -ComputerName Contoso_214`.</span></span>

#### <a name="to-remove-an-authorization-rule"></a><span data-ttu-id="bb750-200">承認規則を削除するには</span><span class="sxs-lookup"><span data-stu-id="bb750-200">To remove an authorization rule</span></span>

1. <span data-ttu-id="bb750-201">Windows PowerShell セッションが開かれていない場合は、このセクションの[非制限的な承認規則を追加する方法](#to-add-a-restrictive-authorization-rule)の手順 1 を参照してください。</span><span class="sxs-lookup"><span data-stu-id="bb750-201">If a Windows PowerShell session is not already open, see step 1 of [to add a restrictive authorization rule](#to-add-a-restrictive-authorization-rule) in this section.</span></span>

2. <span data-ttu-id="bb750-202">次のように入力して **Enter** キーを押します。*rule ID* には削除する規則の一意の ID 番号を指定します。</span><span class="sxs-lookup"><span data-stu-id="bb750-202">Type the following, and then press **Enter**, where *rule ID* represents the unique ID number of the rule that you want to remove.</span></span>

   ```
   Remove-PswaAuthorizationRule -ID <rule ID>
   ```

   <span data-ttu-id="bb750-203">または、削除する規則の ID 番号を知らないがフレンドリ名は知っている場合、規則の名前を取得し、パイプ処理によって名前を `Remove-PswaAuthorizationRule` コマンドレットに渡すことによって、規則を削除できます。次の例を参照してください。</span><span class="sxs-lookup"><span data-stu-id="bb750-203">Alternatively, if you do not know the ID number, but know the friendly name of the rule you want to remove, you can get the name of the rule, and pipe it to the `Remove-PswaAuthorizationRule` cmdlet to remove the rule, as shown in the following example:</span></span>

   ```
   Get-PswaAuthorizationRule `
      -RuleName <rule-name> | Remove-PswaAuthorizationRule
   ```

> [!NOTE]
> <span data-ttu-id="bb750-204">指定した承認規則を削除するかどうかを確認するメッセージは表示されず、**Enter** キーを押すと規則が削除されます。</span><span class="sxs-lookup"><span data-stu-id="bb750-204">You are not prompted to confirm whether you want to delete the specified authorization rule; the rule is deleted when you press **Enter**.</span></span> <span data-ttu-id="bb750-205">`Remove-PswaAuthorizationRule` コマンドレットを実行する前に、削除する承認規則が正しいことを必ず確認してください。</span><span class="sxs-lookup"><span data-stu-id="bb750-205">Be sure that you want to remove the authorization rule before running the `Remove-PswaAuthorizationRule` cmdlet.</span></span>

#### <a name="other-authorization-rule-scenario-examples"></a><span data-ttu-id="bb750-206">承認規則のその他のシナリオの例</span><span class="sxs-lookup"><span data-stu-id="bb750-206">Other authorization rule scenario examples</span></span>

<span data-ttu-id="bb750-207">あらゆる Windows PowerShell セッションはいずれかのセッション構成を使います。セッションにセッション構成が指定されていない場合、Windows PowerShell は、組み込み済みの Windows PowerShell セッション構成である Microsoft.PowerShell という既定値を使います。</span><span class="sxs-lookup"><span data-stu-id="bb750-207">Every Windows PowerShell session uses a session configuration; if one is not specified for a session, Windows PowerShell uses the default, built-in Windows PowerShell session configuration, called Microsoft.PowerShell.</span></span> <span data-ttu-id="bb750-208">既定のセッション構成には、コンピューターで使うことができるすべてのコマンドレットが含まれています。</span><span class="sxs-lookup"><span data-stu-id="bb750-208">The default session configuration includes all cmdlets that are available on a computer.</span></span> <span data-ttu-id="bb750-209">管理者は、制限付き実行空間 (エンド ユーザーが実行できるコマンドレットとタスクの範囲が制限されている) が指定されたセッション構成を定義することで、すべてのコンピューターに対するアクセスを制限できます。</span><span class="sxs-lookup"><span data-stu-id="bb750-209">Administrators can restrict access to all computers by defining a session configuration with a restricted runspace (a limited range of cmdlets and tasks that their end users could perform).</span></span> <span data-ttu-id="bb750-210">1 つのコンピューターに対する全言語でのアクセス、または Windows PowerShell リモート管理コマンドレットだけに対するアクセスを許可されているユーザーは、最初の対象コンピューターに接続されているその他のコンピューターに接続できます。</span><span class="sxs-lookup"><span data-stu-id="bb750-210">A user who is granted access to one computer with either full language access or only the Windows PowerShell remote management cmdlets can connect to other computers that are connected to the first computer.</span></span> <span data-ttu-id="bb750-211">制限付き実行空間を定義することで、許可されている Windows PowerShell 実行空間から他のコンピューターへのユーザー アクセスを阻止し、Windows PowerShell Web Access 環境のセキュリティを強化できます。</span><span class="sxs-lookup"><span data-stu-id="bb750-211">Defining a restricted runspace can prevent users from accessing other computers from their allowed Windows PowerShell runspace, and improves the security of your Windows PowerShell Web Access environment.</span></span> <span data-ttu-id="bb750-212">セッション構成は、Windows PowerShell Web Access からアクセス可能な状態にすると管理者が判断したすべてのコンピューターに (グループ ポリシーを使って) 配布できます。</span><span class="sxs-lookup"><span data-stu-id="bb750-212">The session configuration can be distributed (by using Group Policy) to all computers that administrators want to make accessible through Windows PowerShell Web Access.</span></span> <span data-ttu-id="bb750-213">セッション構成の詳細については、「[about_Session_Configurations](/powershell/module/Microsoft.PowerShell.Core/About/about_session_configurations)」を参照してください。</span><span class="sxs-lookup"><span data-stu-id="bb750-213">For more information about session configurations, see [about_Session_Configurations](/powershell/module/Microsoft.PowerShell.Core/About/about_session_configurations).</span></span>
<span data-ttu-id="bb750-214">次に、シナリオの例をいくつか示します。</span><span class="sxs-lookup"><span data-stu-id="bb750-214">The following are some examples of this scenario.</span></span>

- <span data-ttu-id="bb750-215">管理者が、制限付き実行空間を指定して、**PswaEndpoint** というエンドポイントを作成します。</span><span class="sxs-lookup"><span data-stu-id="bb750-215">An administrator creates an endpoint, called **PswaEndpoint**, with a restricted runspace.</span></span> <span data-ttu-id="bb750-216">その後管理者が `*,*,PswaEndpoint` という規則を作成し、このエンドポイントをその他のコンピューターに配布します。</span><span class="sxs-lookup"><span data-stu-id="bb750-216">Then, the administrator creates a rule, `*,*,PswaEndpoint`, and distributes the endpoint to other computers.</span></span> <span data-ttu-id="bb750-217">この規則によって、エンドポイント **PswaEndpoint** を持つすべてのコンピューターにすべてのユーザーがアクセスできるようになります。</span><span class="sxs-lookup"><span data-stu-id="bb750-217">The rule allows all users to access all computers with the endpoint **PswaEndpoint**.</span></span>
  <span data-ttu-id="bb750-218">規則セットにこの承認規則だけ定義されている場合、このエンドポイントを持たないコンピューターにはアクセスできません。</span><span class="sxs-lookup"><span data-stu-id="bb750-218">If this is the only authorization rule defined in the rule set, computers without that endpoint would not be accessible.</span></span>

- <span data-ttu-id="bb750-219">制限付き実行空間を指定して **PswaEndpoint** というエンドポイントを作成した後は、アクセスを特定のユーザーに制限します。</span><span class="sxs-lookup"><span data-stu-id="bb750-219">The administrator created an endpoint with a restricted runspace called **PswaEndpoint**,and wants to restrict access to specific users.</span></span> <span data-ttu-id="bb750-220">管理者は **Level1Support** というユーザー グループを作成し、次の規則を定義します。**Level1Support、\*、PswaEndpoint**。</span><span class="sxs-lookup"><span data-stu-id="bb750-220">The administrator creates a group of users called **Level1Support**, and defines the following rule: **Level1Support,\*,PswaEndpoint**.</span></span> <span data-ttu-id="bb750-221">この規則によって、**Level1Support** グループのすべてのユーザーが、**PswaEndpoint** 構成を持つコンピューターにアクセスできるようになります。</span><span class="sxs-lookup"><span data-stu-id="bb750-221">The rule grants any users in the group **Level1Support** access to all computers with the **PswaEndpoint** configuration.</span></span> <span data-ttu-id="bb750-222">同様に、アクセスを特定のコンピューターに制限することも可能です。</span><span class="sxs-lookup"><span data-stu-id="bb750-222">Similarly, access can be restricted to a specific set of computers.</span></span>

- <span data-ttu-id="bb750-223">管理者は、その他のユーザーよりも権限の強いアクセスを特定のユーザーに許可することができます。</span><span class="sxs-lookup"><span data-stu-id="bb750-223">Some administrators provide certain users more access than others.</span></span> <span data-ttu-id="bb750-224">たとえば、管理者が、**Admins** と **BasicSupport** という 2 つのユーザー グループを作成します。</span><span class="sxs-lookup"><span data-stu-id="bb750-224">For example, an administrator creates two user groups, **Admins** and **BasicSupport**.</span></span> <span data-ttu-id="bb750-225">管理者はさらに、制限付き実行空間を指定して **PswaEndpoint** というエンドポイントを作成し、**Admins,\*,\*** と **BasicSupport,\*,PswaEndpoint** という 2 つの規則を定義します。</span><span class="sxs-lookup"><span data-stu-id="bb750-225">The administrator also creates an endpoint with a restricted runspace called **PswaEndpoint**, and defines the following two rules: **Admins,\*,\*** and **BasicSupport,\*,PswaEndpoint**.</span></span> <span data-ttu-id="bb750-226">最初の規則は、**Admin** グループのすべてのユーザーにすべてのコンピューターへのアクセスを許可します。2 つ目の規則は、**BasicSupport** グループに、**PswaEndpoint** を持つコンピューターだけに対するアクセスを許可します。</span><span class="sxs-lookup"><span data-stu-id="bb750-226">The first rule provides all users in the **Admin** group access to all computers, and the second rule provides all users in the **BasicSupport** group access only to those computers with **PswaEndpoint**.</span></span>

- <span data-ttu-id="bb750-227">管理者がプライベートなテスト環境をセットアップして、すべての承認済みネットワーク ユーザーに、通常アクセスが許可されるネットワーク内のすべてのコンピューターに対するアクセスと、通常アクセスが許可されるすべてのセッション構成に対するアクセスを許可します。</span><span class="sxs-lookup"><span data-stu-id="bb750-227">An administrator has set up a private test environment, and wants to allow all authorized network users access to all computers on the network to which they typically have access, with access to all session configurations to which they typically have access.</span></span> <span data-ttu-id="bb750-228">これはプライベートなテスト環境であるため、管理者が作成する承認規則は安全ではありません。</span><span class="sxs-lookup"><span data-stu-id="bb750-228">Because this is a private test environment, the administrator creates an authorization rule that is not secure.</span></span> <span data-ttu-id="bb750-229">- 管理者は `Add-PswaAuthorizationRule * * *` コマンドレットを実行します。ここで使われているワイルドカード文字 **\*** は、すべてのコンピューター、すべてのユーザー、すべてのセッション構成をそれぞれ示します。</span><span class="sxs-lookup"><span data-stu-id="bb750-229">- The administrator runs the cmdlet `Add-PswaAuthorizationRule * * *`, which uses the wildcard character **\*** to represent all users, all computers, and all configurations.</span></span> <span data-ttu-id="bb750-230">- この規則は `Add-PswaAuthorizationRule -UserName * -ComputerName * -ConfigurationName *` と同等です。</span><span class="sxs-lookup"><span data-stu-id="bb750-230">- This rule is the equivalent of the following: `Add-PswaAuthorizationRule -UserName * -ComputerName * -ConfigurationName *`.</span></span>

  > [!NOTE]
  > <span data-ttu-id="bb750-231">この規則は、Windows PowerShell Web Access が提供する承認規則によるセキュリティ層をバイパスするものであり、セキュリティ保護された環境には推奨されません。</span><span class="sxs-lookup"><span data-stu-id="bb750-231">This rule is not recommended in a secure environment, and bypasses the authorization rule layer of security provided by Windows PowerShell Web Access.</span></span>

- <span data-ttu-id="bb750-232">管理者は、ワークグループとドメインの両方が含まれている環境で、ターゲット コンピューターへの接続をユーザーに許可する必要があります。ワークグループ コンピューターは、ドメイン内のターゲット コンピューターに接続するために使用されることがあります。ドメイン内のコンピューターは、ワークグループ内のターゲット コンピューターに接続するために使用されることがあります。</span><span class="sxs-lookup"><span data-stu-id="bb750-232">An administrator must allow users to connect to target computers in an environment that includes both workgroups and domains, where workgroup computers are occasionally used to connect to target computers in domains, and computers in domains are occasionally used to connect to target computers in workgroups.</span></span> <span data-ttu-id="bb750-233">ワークグループ内にはゲートウェイ サーバー *PswaServer* があり、ドメイン内にはターゲット コンピューター *srv1.contoso.com* があります。</span><span class="sxs-lookup"><span data-stu-id="bb750-233">The administrator has a gateway server, *PswaServer*, in a workgroup; and target computer *srv1.contoso.com* is in a domain.</span></span> <span data-ttu-id="bb750-234">ユーザー *Chris* は、ワークグループ ゲートウェイ サーバーとターゲット コンピューターの両方で承認されているローカル ユーザーです。</span><span class="sxs-lookup"><span data-stu-id="bb750-234">User *Chris* is an authorized local user on both the workgroup gateway server and the target computer.</span></span> <span data-ttu-id="bb750-235">ワークグループ サーバー上のユーザー名は *chrisLocal*、ターゲット コンピューター上のユーザー名は *contoso\\chris* です。</span><span class="sxs-lookup"><span data-stu-id="bb750-235">His user name on the workgroup server is *chrisLocal*; and his user name on the target computer is *contoso\\chris*.</span></span> <span data-ttu-id="bb750-236">Chris に srv1.contoso.com へのアクセスを承認するには、管理者は以下の規則を追加する必要があります。</span><span class="sxs-lookup"><span data-stu-id="bb750-236">To authorize access to srv1.contoso.com for Chris, the administrator adds the following rule.</span></span>

```powershell
Add-PswaAuthorizationRule -userName PswaServer\chrisLocal `
   -computerName srv1.contoso.com -configurationName Microsoft.PowerShell
```

<span data-ttu-id="bb750-237">この規則例では、Chris がゲートウェイ サーバーで認証され、Chris による *srv1* へのアクセスが承認されます。</span><span class="sxs-lookup"><span data-stu-id="bb750-237">The preceding rule example authenticates Chris on the gateway server, and then authorizes his access to *srv1*.</span></span> <span data-ttu-id="bb750-238">サインイン ページで、Chris は 2 番目の資格情報 (*contoso\\chris*) を **[オプションの接続設定]** に指定する必要があります。</span><span class="sxs-lookup"><span data-stu-id="bb750-238">On the sign-in page, Chris must provide a second set of credentials in the **Optional connection settings** area (*contoso\\chris*).</span></span> <span data-ttu-id="bb750-239">ゲートウェイ サーバーでは、ターゲット コンピューター (*srv1.contoso.com*) で Chris を認証するために、追加の資格情報が使用されます。</span><span class="sxs-lookup"><span data-stu-id="bb750-239">The gateway server uses the additional set of credentials to authenticate him on the target computer, *srv1.contoso.com*.</span></span>

<span data-ttu-id="bb750-240">このシナリオでは、Windows PowerShell Web Access がターゲット コンピューターへの接続に成功するのは、次の動作に成功し、1 つ以上の承認規則で許可された場合のみです。</span><span class="sxs-lookup"><span data-stu-id="bb750-240">In the preceding scenario, Windows PowerShell Web Access establishes a successful connection to the target computer only after the following have been successful, and allowed by at least one authorization rule.</span></span>

1. <span data-ttu-id="bb750-241">*server_name*\\*user_name* の形式のユーザー名を承認規則に追加することによる、ワークグループ ゲートウェイ サーバーでの認証</span><span class="sxs-lookup"><span data-stu-id="bb750-241">Authentication on the workgroup gateway server by adding a user name in the format *server_name*\\*user_name* to the authorization rule</span></span>

2. <span data-ttu-id="bb750-242">サインイン ページの **[オプションの接続設定]** で指定された別の資格情報を使用することによる、ターゲット コンピューターでの認証</span><span class="sxs-lookup"><span data-stu-id="bb750-242">Authentication on the target computer by using alternate credentials provided on the sign-in page, in the **Optional connection settings** area</span></span>

   > [!NOTE]
   > <span data-ttu-id="bb750-243">ゲートウェイ コンピューターとターゲット コンピューターが別々のワークグループまたはドメインにある場合は、2 つのワークグループ コンピューター間、2 つのドメイン間、またはワークグループとドメインの間で、信頼関係を確立する必要があります。</span><span class="sxs-lookup"><span data-stu-id="bb750-243">If gateway and target computers are in different workgroups or domains, a trust relationship must be established between the two workgroup computers, the two domains, or between the workgroup and the domain.</span></span> <span data-ttu-id="bb750-244">Windows PowerShell Web Access の承認規則コマンドレットを使用してこの関係を構成することはできません。</span><span class="sxs-lookup"><span data-stu-id="bb750-244">This relationship cannot be configured by using Windows PowerShell Web Access authorization rule cmdlets.</span></span> <span data-ttu-id="bb750-245">承認規則では、コンピューター間の信頼関係は定義されません。承認規則では、特定のターゲット コンピューターとセッション構成に接続できるようにユーザーを承認することしかできません。</span><span class="sxs-lookup"><span data-stu-id="bb750-245">Authorization rules do not define a trust relationship between computers; they can only authorize users to connect to specific target computers and session configurations.</span></span> <span data-ttu-id="bb750-246">異なるドメイン間で信頼関係を構成する方法の詳細については、[ドメインおよびフォレストの信頼の作成に関するページ](/previous-versions/windows/it-pro/windows-server-2008-R2-and-2008/cc794775(v=ws.10))を参照してください。</span><span class="sxs-lookup"><span data-stu-id="bb750-246">For more information about how to configure a trust relationship between different domains, see [Creating Domain and Forest Trusts](/previous-versions/windows/it-pro/windows-server-2008-R2-and-2008/cc794775(v=ws.10)).</span></span>
   > <span data-ttu-id="bb750-247">信頼されたホストの一覧にワークグループ コンピューターを追加する方法の詳細については、「[サーバー マネージャーによるリモート管理](/previous-versions/windows/it-pro/windows-server-2008-R2-and-2008/dd759202(v=ws.11))」を参照してください。</span><span class="sxs-lookup"><span data-stu-id="bb750-247">For more information about how to add workgroup computers to a trusted hosts list, see [Remote Management with Server Manager](/previous-versions/windows/it-pro/windows-server-2008-R2-and-2008/dd759202(v=ws.11)).</span></span>

### <a name="using-a-single-set-of-authorization-rules-for-multiple-sites"></a><span data-ttu-id="bb750-248">1 セットの承認規則の複数サイトでの使用</span><span class="sxs-lookup"><span data-stu-id="bb750-248">Using a single set of authorization rules for multiple sites</span></span>

<span data-ttu-id="bb750-249">承認規則は 1 つの XML ファイルに格納されます。</span><span class="sxs-lookup"><span data-stu-id="bb750-249">Authorization rules are stored in an XML file.</span></span> <span data-ttu-id="bb750-250">既定では、XML ファイルのパス名は `$env:windir\Web\PowershellWebAccess\data\AuthorizationRules.xml` です。</span><span class="sxs-lookup"><span data-stu-id="bb750-250">By default, the path name of the XML file is `$env:windir\Web\PowershellWebAccess\data\AuthorizationRules.xml`.</span></span>

<span data-ttu-id="bb750-251">承認規則 XML ファイルのパスは、**powwa.config** ファイルに格納されます。このファイルは `$env:windir\Web\PowershellWebAccess\data` にあります。</span><span class="sxs-lookup"><span data-stu-id="bb750-251">The path to the authorization rules XML file is stored in the **powwa.config** file, which is found in `$env:windir\Web\PowershellWebAccess\data`.</span></span> <span data-ttu-id="bb750-252">管理者は、**powwa.config** に記述されている既定パスへの参照を、設定や要件に合わせて柔軟に変更することができます。</span><span class="sxs-lookup"><span data-stu-id="bb750-252">The administrator has the flexibility to change the reference to the default path in **powwa.config** to suit preferences or requirements.</span></span> <span data-ttu-id="bb750-253">管理者がファイルの場所を変更できるので、構成上の必要に応じて、複数の Windows PowerShell Web Access ゲートウェイが同じ承認規則を使うことができるようになります。</span><span class="sxs-lookup"><span data-stu-id="bb750-253">Allowing the administrator to change the location of the file lets multiple Windows PowerShell Web Access gateways use the same authorization rules, if such a configuration is desired.</span></span>

## <a name="session-management"></a><span data-ttu-id="bb750-254">セッションの管理</span><span class="sxs-lookup"><span data-stu-id="bb750-254">Session management</span></span>

<span data-ttu-id="bb750-255">Windows PowerShell Web Access では、ユーザーが同時に接続できるセッションは既定で 3 つまでに制限されています。</span><span class="sxs-lookup"><span data-stu-id="bb750-255">By default, Windows PowerShell Web Access limits a user to three sessions at one time.</span></span> <span data-ttu-id="bb750-256">Web アプリケーションの **web.config** ファイルを IIS マネージャーで編集することで、ユーザーごとにサポートされるセッションの数を変更できます。</span><span class="sxs-lookup"><span data-stu-id="bb750-256">You can edit the web application's **web.config** file in IIS Manager to support a different number of sessions per user.</span></span> <span data-ttu-id="bb750-257">**web.config** ファイルへのパスは `$env:windir\Web\PowerShellWebAccess\wwwroot\Web.config` です。</span><span class="sxs-lookup"><span data-stu-id="bb750-257">The path to the **web.config** file is `$env:windir\Web\PowerShellWebAccess\wwwroot\Web.config`.</span></span>

<span data-ttu-id="bb750-258">何らかの設定が編集された場合、IIS Web サーバーの既定の構成によってアプリケーション プールが再起動します。</span><span class="sxs-lookup"><span data-stu-id="bb750-258">By default, IIS Web Server is configured to restart the application pool if any settings are edited.</span></span> <span data-ttu-id="bb750-259">たとえば **web.config** ファイルが編集された場合、アプリケーション プールが再起動します。</span><span class="sxs-lookup"><span data-stu-id="bb750-259">For example, the application pool is restarted if changes are made to the **web.config** file.</span></span> <span data-ttu-id="bb750-260">**Windows PowerShell Web Access** はインメモリ セッション状態を使うため、アプリケーション プールの再起動によって、**Windows PowerShell Web Access** セッションにサインインしているユーザーのセッションは切断されます。</span><span class="sxs-lookup"><span data-stu-id="bb750-260">>Because **Windows PowerShell Web Access** uses in-memory session states, >users signed in to **Windows PowerShell Web Access** sessions lose their sessions when the application pool is restarted.</span></span>

### <a name="setting-default-parameters-on-the-sign-in-page"></a><span data-ttu-id="bb750-261">サインイン ページに既定のパラメーターを設定する</span><span class="sxs-lookup"><span data-stu-id="bb750-261">Setting default parameters on the sign-in page</span></span>

<span data-ttu-id="bb750-262">Windows PowerShell Web Access ゲートウェイを Windows Server 2012 R2 で実行する場合、Windows PowerShell Web Access サインイン ページに表示される設定に既定の値を構成できます。</span><span class="sxs-lookup"><span data-stu-id="bb750-262">If your Windows PowerShell Web Access gateway is running on Windows Server 2012 R2, you can configure default values for the settings that are displayed on the Windows PowerShell Web Access sign-in page.</span></span> <span data-ttu-id="bb750-263">前の段落で説明されている **web.config** ファイルに値を構成できます。</span><span class="sxs-lookup"><span data-stu-id="bb750-263">You can configure values in the **web.config** file that is described in the preceding paragraph.</span></span> <span data-ttu-id="bb750-264">サインイン ページの設定の既定値は、web.config ファイルの **appSettings** セクションにあります。**appSettings** セクションの例を次に示します。</span><span class="sxs-lookup"><span data-stu-id="bb750-264">Default values for the sign-in page settings are found in the **appSettings** section of the web.config file; the following is an example of the **appSettings** section.</span></span> <span data-ttu-id="bb750-265">これらの設定の多くに有効な値は、Windows PowerShell の [New-PSSession](/powershell/module/Microsoft.PowerShell.Core/New-PSSession) コマンドレットの対応するパラメーターのものと同じです。</span><span class="sxs-lookup"><span data-stu-id="bb750-265">Valid values for many of these settings are the same as those for the corresponding parameters of the [New-PSSession](/powershell/module/Microsoft.PowerShell.Core/New-PSSession) cmdlet in Windows PowerShell.</span></span>

<span data-ttu-id="bb750-266">たとえば、次のコード ブロックに示された `defaultApplicationName` キーは、ターゲット コンピューター上の **$PSSessionApplicationName** ユーザー設定変数の値になります。</span><span class="sxs-lookup"><span data-stu-id="bb750-266">For example, the `defaultApplicationName` key, as shown in the following code block, is the value of the **$PSSessionApplicationName** preference variable on the target computer.</span></span>

```xml
  <appSettings>
      <add key="maxSessionsAllowedPerUser" value="3"/>
      <add key="defaultPortNumber" value="5985"/>
      <add key="defaultSSLPortNumber" value="5986"/>
      <add key="defaultApplicationName" value="WSMAN"/>
      <add key="defaultUseSslSelection" value="0"/>
      <add key="defaultAuthenticationType" value="0"/>
      <add key="defaultAllowRedirection" value="0"/>
      <add key="defaultConfigurationName" value="Microsoft.PowerShell"/>
  </appSettings>
```

### <a name="time-outs-and-unplanned-disconnections"></a><span data-ttu-id="bb750-267">タイムアウトと計画外の切断</span><span class="sxs-lookup"><span data-stu-id="bb750-267">Time-outs and unplanned disconnections</span></span>

<span data-ttu-id="bb750-268">Windows PowerShell Web Access セッションではタイムアウトが発生します。Windows Server 2012 で実行する Windows PowerShell Web Access では、非アクティブな状態が 15 分続くと、セッションのタイムアウト メッセージがサインインしているユーザーに対して表示されます。</span><span class="sxs-lookup"><span data-stu-id="bb750-268">Windows PowerShell Web Access sessions time out. In Windows PowerShell Web Access running on Windows Server 2012, A time-out message is displayed to signed-in users after 15 minutes of session inactivity.</span></span> <span data-ttu-id="bb750-269">タイムアウト メッセージが表示されてから 5 分以内にユーザーの応答がない場合、セッションが終了しユーザーがサインアウトされます。セッションのタイムアウト時間は、IIS マネージャーの Web サイト設定で変更できます。</span><span class="sxs-lookup"><span data-stu-id="bb750-269">If the user does not respond within five minutes after the time-out message is displayed, the session is ended, and the user is signed out. You can change time-out periods for sessions in the website settings in IIS Manager.</span></span>

<span data-ttu-id="bb750-270">Windows Server 2012 R2 で実行する Windows PowerShell Web Access では、非アクティブな状態が 20 分続くと、セッションは既定でタイムアウトします。</span><span class="sxs-lookup"><span data-stu-id="bb750-270">In Windows PowerShell Web Access running on Windows Server 2012 R2, sessions time out, by default, after 20 minutes of inactivity.</span></span> <span data-ttu-id="bb750-271">ユーザー自身がセッションを閉じたためではなく、ネットワーク エラーまたはその他の予期しないシャットダウンや障害のために、ユーザーがセッションから切断された場合、クライアント側でタイムアウト期間が経過するまで、Windows PowerShell Web Access セッションは実行を続け、ターゲット コンピューターに接続されたままになります。</span><span class="sxs-lookup"><span data-stu-id="bb750-271">If users are disconnected from sessions in the web-based console because of network errors or other unplanned shutdowns or failures, and not because they have closed the sessions themselves, the Windows PowerShell Web Access sessions continue to run, connected to target computers, until the time-out period on the client side lapses.</span></span> <span data-ttu-id="bb750-272">既定の 20 分またはゲートウェイ管理者が指定したタイムアウト期間のどちらか短い方が経過すると、セッションは切断されます。</span><span class="sxs-lookup"><span data-stu-id="bb750-272">The session is disconnected after either the default 20 minutes, or after the time-out period specified by the gateway administrator, whichever is shorter.</span></span>

<span data-ttu-id="bb750-273">ゲートウェイ サーバーが Windows Server 2012 R2 を実行している場合の Windows PowerShell Web Access では、ユーザーは保存されているセッションに再接続できますが、ネットワーク エラー、予期しないシャットダウン、または他のエラーによるセッションの切断が発生した場合、ユーザーはゲートウェイ管理者によって指定されたタイムアウト期間が経過するまでは、保存されているセッションを表示または再接続できません。</span><span class="sxs-lookup"><span data-stu-id="bb750-273">If the gateway server is running Windows Server 2012 R2, Windows PowerShell Web Access lets users reconnect to saved sessions at a later time, but when network errors, unplanned shutdowns, or other failures disconnect sessions, users cannot see or reconnect to saved sessions until after the time-out period specified by the gateway administrator has lapsed.</span></span>

## <a name="see-also"></a><span data-ttu-id="bb750-274">参照</span><span class="sxs-lookup"><span data-stu-id="bb750-274">See Also</span></span>

<span data-ttu-id="bb750-275">[Windows PowerShell Web Access のインストールと使用](/previous-versions/windows/it-pro/windows-server-2012-R2-and-2012/hh831611(v=ws.11))</span><span class="sxs-lookup"><span data-stu-id="bb750-275">[Install and Use Windows PowerShell Web Access](/previous-versions/windows/it-pro/windows-server-2012-R2-and-2012/hh831611(v=ws.11))</span></span>

[<span data-ttu-id="bb750-276">about_Session_Configurations</span><span class="sxs-lookup"><span data-stu-id="bb750-276">about_Session_Configurations</span></span>](/powershell/module/microsoft.powershell.core/about/about_Session_Configurations)

[<span data-ttu-id="bb750-277">Windows PowerShell Web Access のコマンドレット</span><span class="sxs-lookup"><span data-stu-id="bb750-277">Windows PowerShell Web Access Cmdlets</span></span>](/powershell/module/powershellwebaccess/?view=winserver2012r2-ps)
