---
title: 管理 OData Web サービスにリソースを追加する |Microsoft Docs
ms.custom: ''
ms.date: 09/13/2016
ms.reviewer: ''
ms.suite: ''
ms.tgt_pltfrm: ''
ms.topic: article
ms.assetid: e620bf6d-76be-47b0-a7a8-f43418f30c60
caps.latest.revision: 6
ms.openlocfilehash: b81a32b867795ae51c3f5308c2f82c31ed2747fa
ms.sourcegitcommit: 52a67bcd9d7bf3e8600ea4302d1fa8970ff9c998
ms.translationtype: MT
ms.contentlocale: ja-JP
ms.lasthandoff: 10/15/2019
ms.locfileid: "72359821"
---
# <a name="adding-resources-to-a-management-odata-web-service"></a><span data-ttu-id="f03c4-102">Management OData Web サービスにリソースを追加する</span><span class="sxs-lookup"><span data-stu-id="f03c4-102">Adding Resources to a Management OData Web Service</span></span>

<span data-ttu-id="f03c4-103">この例では、管理用の OData スキーマデザイナーを使用して、既存の管理 OData web サービスにリソースを追加する方法を示します。</span><span class="sxs-lookup"><span data-stu-id="f03c4-103">This example demonstrates how to add a resource to an existing Management OData web service by using the Management OData Schema Designer.</span></span> <span data-ttu-id="f03c4-104">[Pswsroleベースのプラグイン](https://code.msdn.microsoft.com:443/windowsdesktop/PswsRoleBasedPlugins-9c79b75a)のサンプルでは、プロセスリソースとサーバーリソースを公開する web サービスを作成します。</span><span class="sxs-lookup"><span data-stu-id="f03c4-104">The [PswsRoleBasedPlugins](https://code.msdn.microsoft.com:443/windowsdesktop/PswsRoleBasedPlugins-9c79b75a) sample creates a web service that exposes the Process and Server resources.</span></span> <span data-ttu-id="f03c4-105">この例では、仮想マシン (VM) リソースを web サービスに追加します。</span><span class="sxs-lookup"><span data-stu-id="f03c4-105">In this example, you will add a Virtual Machine (VM) resource to the web service.</span></span>

## <a name="prerequisites"></a><span data-ttu-id="f03c4-106">必要条件</span><span class="sxs-lookup"><span data-stu-id="f03c4-106">Prerequisites</span></span>

<span data-ttu-id="f03c4-107">このトピックでは、「 [Windows PowerShell Web サービスの作成](./creating-a-management-odata-web-service.md)」で説明されているように[Pswsroleñプラグイン](https://code.msdn.microsoft.com:443/windowsdesktop/PswsRoleBasedPlugins-9c79b75a)サンプルをダウンロードしてインストールし、 [Management OData スキーマデザイナー](https://marketplace.visualstudio.com/items?itemName=jlisc0.ManagementODataSchemaDesigner)をダウンロードしてインストールしたことを前提としています。</span><span class="sxs-lookup"><span data-stu-id="f03c4-107">This topic assumes that you have downloaded and installed the [PswsRoleBasedPlugins](https://code.msdn.microsoft.com:443/windowsdesktop/PswsRoleBasedPlugins-9c79b75a) sample as described in [Creating a Windows PowerShell Web Service](./creating-a-management-odata-web-service.md), and that you have downloaded and installed the [Management OData Schema Designer](https://marketplace.visualstudio.com/items?itemName=jlisc0.ManagementODataSchemaDesigner).</span></span> <span data-ttu-id="f03c4-108">また、このトピックでは、Management Odata エンドポイントを設定するコンピューターに Hyper-v Windows PowerShell モジュールがインストールされていることを前提としています。</span><span class="sxs-lookup"><span data-stu-id="f03c4-108">This topic also assumes that you have the Hyper-V Windows PowerShell module installed on the computer where you set up the Management Odata endpoint.</span></span>

## <a name="adding-vm-as-a-resource-to-the-web-service"></a><span data-ttu-id="f03c4-109">VM をリソースとして Web サービスに追加する</span><span class="sxs-lookup"><span data-stu-id="f03c4-109">Adding VM as a Resource to the Web Service</span></span>

<span data-ttu-id="f03c4-110">最初の手順では、既存の管理 OData エンドポイントからスキーマデザイナーにスキーマをインポートします。</span><span class="sxs-lookup"><span data-stu-id="f03c4-110">The first step is to import the schema from the existing Management OData endpoint into the schema designer.</span></span> <span data-ttu-id="f03c4-111">次の手順では、その方法について説明します。</span><span class="sxs-lookup"><span data-stu-id="f03c4-111">The following procedure describes how to do that.</span></span>

#### <a name="importing-an-existing-schema-into-the-schema-designer"></a><span data-ttu-id="f03c4-112">スキーマデザイナーへの既存のスキーマのインポート</span><span class="sxs-lookup"><span data-stu-id="f03c4-112">Importing an existing schema into the schema designer</span></span>

1. <span data-ttu-id="f03c4-113">管理用の OData スキーマデザイナーを開きます。</span><span class="sxs-lookup"><span data-stu-id="f03c4-113">Open the Management OData Schema Designer.</span></span>

2. <span data-ttu-id="f03c4-114">**[ファイル]** メニューの **[ファイル]** を選択します。**新規**;**ファイル**。</span><span class="sxs-lookup"><span data-stu-id="f03c4-114">From the **File** menu, select **File** ; **New** ; **File**.</span></span> <span data-ttu-id="f03c4-115">**[新しいファイル]** ダイアログボックスが表示されます。</span><span class="sxs-lookup"><span data-stu-id="f03c4-115">The **New File** dialog appears.</span></span>

3. <span data-ttu-id="f03c4-116">[**管理] [OData モデル**] の順にクリックし、 **[開く]** をクリックします。</span><span class="sxs-lookup"><span data-stu-id="f03c4-116">Click **Management OData Model**, and then click **Open**.</span></span>

4. <span data-ttu-id="f03c4-117">メインウィンドウ内を右クリックし、 **[スキーマファイル]** をクリックします。**インポート**。</span><span class="sxs-lookup"><span data-stu-id="f03c4-117">Right-click in the main window, and click **Schema file** ; **Import**.</span></span> <span data-ttu-id="f03c4-118">**[開く]** ダイアログボックスが表示されます。</span><span class="sxs-lookup"><span data-stu-id="f03c4-118">The **Open** dialog appears.</span></span>

5. <span data-ttu-id="f03c4-119">[Pswsroleベースプラグイン](https://code.msdn.microsoft.com:443/windowsdesktop/PswsRoleBasedPlugins-9c79b75a)サンプル用の管理 OData web サービスを設定するフォルダーに移動します。</span><span class="sxs-lookup"><span data-stu-id="f03c4-119">Navigate to the folder where you set up the Management OData web service for the [PswsRoleBasedPlugins](https://code.msdn.microsoft.com:443/windowsdesktop/PswsRoleBasedPlugins-9c79b75a) sample.</span></span> <span data-ttu-id="f03c4-120">このサンプルに用意されている Windows PowerShell スクリプトを使用して、スクリプトを変更せずにエンドポイントを設定した場合、そのフォルダーは**C:\inetpub\wwwroot\Modata**になります。</span><span class="sxs-lookup"><span data-stu-id="f03c4-120">If you used the Windows PowerShell script provided with that sample to set up the endpoint without modifying the script, that folder is **C:\inetpub\wwwroot\Modata**.</span></span> <span data-ttu-id="f03c4-121">スキーマ .mof を選択し、**開く** をクリックします。</span><span class="sxs-lookup"><span data-stu-id="f03c4-121">Select Schema.mof, and click **Open**.</span></span>

   <span data-ttu-id="f03c4-122">この時点で、スキーマの .mof ファイルと Schema .xml ファイルをテキストエディターで開き、プロセスとサービスリソースのマッピングが含まれていることを確認します。</span><span class="sxs-lookup"><span data-stu-id="f03c4-122">At this point, open the Schema.mof and Schema.xml files in a text editor, and notice that they contain mappings for the Process and Service resources.</span></span> <span data-ttu-id="f03c4-123">スキーマ .mof ファイルは、[分散管理タスクフォース](https://www.dmtf.org/)(DTMF) 管理オブジェクト (mof) 標準を使用します。</span><span class="sxs-lookup"><span data-stu-id="f03c4-123">The Schema.mof file uses [Distributed Management  Task Force](https://www.dmtf.org/) (DTMF) Managed Object (MOF) standard.</span></span> <span data-ttu-id="f03c4-124">スキーマ .xml ファイルは、「[リソースマッピングスキーマ](./resource-mapping-schema.md)」で説明されている xml スキーマを使用します。</span><span class="sxs-lookup"><span data-stu-id="f03c4-124">The schema.xml file uses an XML schema that is described in [Resource Mapping Schema](./resource-mapping-schema.md).</span></span>

   <span data-ttu-id="f03c4-125">次の手順では、の Hyper-v コマンドレットをスキーマモデルにインポートする方法について説明します。</span><span class="sxs-lookup"><span data-stu-id="f03c4-125">The following procedure describes how to import Hyper-V cmdlets in to the schema model.</span></span>

#### <a name="importing-cmdlets-into-the-schema"></a><span data-ttu-id="f03c4-126">スキーマへのコマンドレットのインポート</span><span class="sxs-lookup"><span data-stu-id="f03c4-126">Importing cmdlets into the schema</span></span>

1. <span data-ttu-id="f03c4-127">スキーマデザイナーウィンドウの空白部分を右クリックし、 **[コマンドレットのインポート]** をクリックします。</span><span class="sxs-lookup"><span data-stu-id="f03c4-127">Right-click on a blank area of the schema designer window, and click **Import Cmdlets**.</span></span> <span data-ttu-id="f03c4-128">**[コマンドレットのインポートウィザード]** ダイアログボックスが表示されます。</span><span class="sxs-lookup"><span data-stu-id="f03c4-128">The **Cmdlet Import Wizard** dialog appears.</span></span>

2. <span data-ttu-id="f03c4-129">**[ローカルコンピューター]** が選択されていることを確認し、 **[次へ]** をクリックします。</span><span class="sxs-lookup"><span data-stu-id="f03c4-129">Make sure **Local Computer** is selected, and click **Next**.</span></span>

3. <span data-ttu-id="f03c4-130">インストールされている Windows PowerShell モジュールが選択されていることを確認し、ドロップダウンリストから [Hyper-v] を選択します。</span><span class="sxs-lookup"><span data-stu-id="f03c4-130">Make sure that Installed Windows PowerShell Modules is selected, and select Hyper-V from the drop-down list.</span></span> <span data-ttu-id="f03c4-131">**[次へ]** をクリックします。</span><span class="sxs-lookup"><span data-stu-id="f03c4-131">click **Next**.</span></span> <span data-ttu-id="f03c4-132">**[次へ]** をクリックします。</span><span class="sxs-lookup"><span data-stu-id="f03c4-132">Click **Next**.</span></span>

4. <span data-ttu-id="f03c4-133">**[コマンドレットの名詞]** ボックスの一覧で、 **[VM]** を選択します。</span><span class="sxs-lookup"><span data-stu-id="f03c4-133">In the **Cmdlet Noun** list, select **VM**.</span></span> <span data-ttu-id="f03c4-134">**[次へ]** をクリックします。</span><span class="sxs-lookup"><span data-stu-id="f03c4-134">Click **Next**</span></span>

5. <span data-ttu-id="f03c4-135">この例では、コマンドレットを使用して Get コマンドと Delete コマンドだけをバインドします。</span><span class="sxs-lookup"><span data-stu-id="f03c4-135">For this example, we will bind only the Get and Delete commands with cmdlets.</span></span> <span data-ttu-id="f03c4-136">[**作成**と**更新**] チェックボックスをオフにし、 **[取得]** および **[削除]** チェックボックスがオンになっていることを確認します。</span><span class="sxs-lookup"><span data-stu-id="f03c4-136">Clear the **CREATE** and **UPDATE** checkboxes, and make sure the **GET** and **DELETE** checkboxes are checked.</span></span> <span data-ttu-id="f03c4-137">**GET**用に `Get-VM` コマンドレットが選択されていることと、@no__t 2 つのコマンドレットが**削除**対象として選択されていることを確認します。</span><span class="sxs-lookup"><span data-stu-id="f03c4-137">Make sure that the `Get-VM` cmdlet is selected for **GET**, and the `Remove-VM` cmdlet is selected for **DELETE**.</span></span>

6. <span data-ttu-id="f03c4-138">VM コマンドレットのメタデータには出力の種類が指定されていないため、コマンドレットを実行して出力の種類を指定する必要があります。</span><span class="sxs-lookup"><span data-stu-id="f03c4-138">Because the metadata for the VM cmdlets does not specify an output type, you will need to run the cmdlet to specify the output type.</span></span> <span data-ttu-id="f03c4-139">**[出力の種類を指定]** を選択し、 **[コマンドレットの実行]** をクリックします。</span><span class="sxs-lookup"><span data-stu-id="f03c4-139">Select **Provide output type** and click **Run cmdlet**.</span></span> <span data-ttu-id="f03c4-140">**[コマンドレットの実行]** ダイアログが表示されます。</span><span class="sxs-lookup"><span data-stu-id="f03c4-140">The **Run Cmdlet** dialog appears.</span></span> <span data-ttu-id="f03c4-141">**[実行]** をクリックします。</span><span class="sxs-lookup"><span data-stu-id="f03c4-141">Click **Run**.</span></span> <span data-ttu-id="f03c4-142">**[CLR 型]** ボックスに `VirtualMachine` の型が設定されます。</span><span class="sxs-lookup"><span data-stu-id="f03c4-142">The **CLR Type** box is populated with the `VirtualMachine` type.</span></span> <span data-ttu-id="f03c4-143">**[OK]** をクリックし、 **[次へ]** をクリックします。</span><span class="sxs-lookup"><span data-stu-id="f03c4-143">Click **OK**, then click **Next**.</span></span>

7. <span data-ttu-id="f03c4-144">既定では、VirtualMachine オブジェクトのすべてのプロパティが選択されています。</span><span class="sxs-lookup"><span data-stu-id="f03c4-144">By default, all of the properties of the VirtualMachine object are selected.</span></span> <span data-ttu-id="f03c4-145">このリソースを web サービスから要求したときに返されるデータの一部としては、必要のないプロパティはクリアできます。</span><span class="sxs-lookup"><span data-stu-id="f03c4-145">You can clear any properties that you do not want as part of the data returned when you request this resource from the web service.</span></span> <span data-ttu-id="f03c4-146">**[次へ]** をクリックします。</span><span class="sxs-lookup"><span data-stu-id="f03c4-146">Click **Next**.</span></span>

8. <span data-ttu-id="f03c4-147">キーとして使用するプロパティを少なくとも1つ選択する必要があります。</span><span class="sxs-lookup"><span data-stu-id="f03c4-147">You must select at least one property to be used as a key.</span></span> <span data-ttu-id="f03c4-148">一覧で **[名前]** を選択し、 **[次へ]** をクリックします。</span><span class="sxs-lookup"><span data-stu-id="f03c4-148">Select **Name** in the list, and click **Next**.</span></span>

9. <span data-ttu-id="f03c4-149">次のウィンドウでは、管理用の OData リソースのプロパティを、基になるコマンドレットのプロパティにマップできます。</span><span class="sxs-lookup"><span data-stu-id="f03c4-149">The next window allows you to map properties of the Management OData resource to properties of the underlying cmdlets.</span></span> <span data-ttu-id="f03c4-150">既定では、同じ名前のプロパティがマップされます。</span><span class="sxs-lookup"><span data-stu-id="f03c4-150">The wizard maps properties with identical names by default.</span></span> <span data-ttu-id="f03c4-151">たとえば、リソースの `ComputerName` プロパティは、コマンドレットの `ComputerName` プロパティにマップされます。</span><span class="sxs-lookup"><span data-stu-id="f03c4-151">For example, the `ComputerName` property of the resource is mapped to the `ComputerName` property of the cmdlets.</span></span>  <span data-ttu-id="f03c4-152">これにより、web サービスへの要求で `ComputerName` プロパティを指定し、指定した値を `Get-VM` コマンドレットに渡すことができます。</span><span class="sxs-lookup"><span data-stu-id="f03c4-152">This allows you to specify the `ComputerName` property in a request to the web service, and have the value you specify be passed to the `Get-VM` cmdlet.</span></span> <span data-ttu-id="f03c4-153">`Id` および `Name` も既定でマップされます。</span><span class="sxs-lookup"><span data-stu-id="f03c4-153">`Id` and `Name` are also mapped by default.</span></span>

   10. <span data-ttu-id="f03c4-154">**[次へ]** をクリックし、 **[完了]** をクリックします。</span><span class="sxs-lookup"><span data-stu-id="f03c4-154">Click **Next**, then click **Finish**.</span></span>

       <span data-ttu-id="f03c4-155">これで、VM リソースがスキーマデザイナーウィンドウに表示されます。</span><span class="sxs-lookup"><span data-stu-id="f03c4-155">The VM resource now appears in the schema designer window.</span></span> <span data-ttu-id="f03c4-156">リソースに関連付けられているプロパティと操作を確認できます。</span><span class="sxs-lookup"><span data-stu-id="f03c4-156">You can examine the properties and operations associated with the resource.</span></span> <span data-ttu-id="f03c4-157">次に、更新されたスキーマファイルを web サービスの仮想ディレクトリにエクスポートします。</span><span class="sxs-lookup"><span data-stu-id="f03c4-157">Next, you will export the updated schema files into the virtual directory for the web service.</span></span>

#### <a name="exporting-schema-files-from-the-schema-designer"></a><span data-ttu-id="f03c4-158">スキーマデザイナーからのスキーマファイルのエクスポート</span><span class="sxs-lookup"><span data-stu-id="f03c4-158">Exporting schema files from the schema designer</span></span>

1. <span data-ttu-id="f03c4-159">スキーマデザイナーウィンドウの空白の領域を右クリックし、 **[スキーマファイル]** をクリックします。**エクスポート**。</span><span class="sxs-lookup"><span data-stu-id="f03c4-159">Right-click on a blank area of the schema designer window, and click **Schema file** ; **Export**.</span></span> <span data-ttu-id="f03c4-160">**[名前を付けて保存]** ダイアログボックスが表示されます。</span><span class="sxs-lookup"><span data-stu-id="f03c4-160">The **Save As** dialog appears.</span></span>

2. <span data-ttu-id="f03c4-161">MOF ファイルをインポートしたディレクトリに移動します。</span><span class="sxs-lookup"><span data-stu-id="f03c4-161">Navigate to the same directory from where you imported the MOF file.</span></span> <span data-ttu-id="f03c4-162">ファイルに元の MOF ファイルと同じ名前を付け (既定では Schema .mof)、 **[保存]** をクリックします。</span><span class="sxs-lookup"><span data-stu-id="f03c4-162">Name the file the same as the original MOF file (Schema.mof by default), and click **Save**.</span></span> <span data-ttu-id="f03c4-163">既存のファイルを上書きすることを確認します。</span><span class="sxs-lookup"><span data-stu-id="f03c4-163">Confirm that you want to overwrite the existing file.</span></span>

   <span data-ttu-id="f03c4-164">**[名前を付けて保存]** ダイアログに明示的に指定されていませんが、スキーマの .mof ファイルとスキーマ .xml ファイルの両方を置き換えます。</span><span class="sxs-lookup"><span data-stu-id="f03c4-164">Although it is not explicitly stated in the **Save As** dialog, this replaces both the Schema.mof and Schema.xml files.</span></span>

## <a name="next-steps"></a><span data-ttu-id="f03c4-165">次の手順</span><span class="sxs-lookup"><span data-stu-id="f03c4-165">Next Steps</span></span>

<span data-ttu-id="f03c4-166">Management OData web サービスから新しい VM リソースにアクセスする前に、「[ロールベースの承認の構成](./configuring-role-based-authorization.md)」で説明されているように、Hyper-v Windows PowerShell モジュールへのアクセスを許可するように RbacConfiguration .xml ファイルを更新する必要があります。また、web サービスを再起動する必要があります。</span><span class="sxs-lookup"><span data-stu-id="f03c4-166">Before you access the new VM resource from the Management OData web service, you must update the RbacConfiguration.xml file to allow access to the Hyper-V Windows PowerShell module as described in [Configuring Role-based Authorization](./configuring-role-based-authorization.md), and you will also need to restart the web service.</span></span>